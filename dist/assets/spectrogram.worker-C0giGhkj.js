function I(n,e){return new Promise(t=>{n.addEventListener("message",function s({data:i}){i?.type===e&&(n.removeEventListener("message",s),t(i))})})}I(self,"wasm_bindgen_worker_init").then(async({init:n,receiver:e})=>{const t=await Promise.resolve().then(function(){return se});await t.default(n),postMessage({type:"wasm_bindgen_worker_ready"}),t.wbg_rayon_start_worker(e)});async function G(n,e,t){if(t.numThreads()===0)throw new Error("num_threads must be > 0.");const s={type:"wasm_bindgen_worker_init",init:{module_or_path:n,memory:e},receiver:t.receiver()};await Promise.all(Array.from({length:t.numThreads()},async()=>{const i=new Worker(new URL(""+new URL("workerHelpers-CbUIYjd9.js",import.meta.url).href,import.meta.url),{type:"module"});return i.postMessage(s),await I(i,"wasm_bindgen_worker_ready"),i})),t.build()}let r,b=null;function W(){return(b===null||b.buffer!==r.memory.buffer)&&(b=new Uint8Array(r.memory.buffer)),b}let d=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):void 0;d&&d.decode();const H=2146435072;let A=0;function Y(n,e){return A+=e,A>=H&&(d=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),d.decode(),A=e),d.decode(W().slice(n,n+e))}function S(n,e){return n=n>>>0,Y(n,e)}function l(n){const e=r.__externref_table_alloc();return r.__wbindgen_externrefs.set(e,n),e}function q(n,e){try{return n.apply(this,e)}catch(t){const s=l(t);r.__wbindgen_exn_store(s)}}function h(n){return n==null}let p=null;function X(){return(p===null||p.buffer!==r.memory.buffer)&&(p=new Float32Array(r.memory.buffer)),p}let E=0;function V(n,e){const t=e(n.length*4,4)>>>0;return X().set(n,t/4),E=n.length,t}function Z(n,e){const t=e(n.length*1,1)>>>0;return W().set(n,t/1),E=n.length,t}function $(n,e){if(!(n instanceof e))throw new Error(`expected instance of ${e.name}`)}function J(n){const e=r.__wbindgen_externrefs.get(n);return r.__externref_table_dealloc(n),e}function K(n,e){return n=n>>>0,W().subarray(n/1,n/1+e)}function D(n,e,t){const s=V(n,r.__wbindgen_malloc),i=E,_=Z(e,r.__wbindgen_malloc),g=E;$(t,m);const o=r.generate_spectrogram_image(s,i,_,g,t.__wbg_ptr);if(o[3])throw J(o[2]);var f=K(o[0],o[1]).slice();return r.__wbindgen_free(o[0],o[1]*1,1),f}function P(n){return r.initThreadPool(n)}function Q(n){r.wbg_rayon_start_worker(n)}const F=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>r.__wbg_spectrogramconfig_free(n>>>0,1));class m{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,F.unregister(this),e}free(){const e=this.__destroy_into_raw();r.__wbg_spectrogramconfig_free(e,0)}constructor(e,t,s,i,_,g){const o=r.spectrogramconfig_new(e,t,s,i,_,g);return this.__wbg_ptr=o>>>0,F.register(this,this.__wbg_ptr,this),this}get sample_rate(){return r.__wbg_get_spectrogramconfig_sample_rate(this.__wbg_ptr)>>>0}set sample_rate(e){r.__wbg_set_spectrogramconfig_sample_rate(this.__wbg_ptr,e)}get fft_size(){return r.__wbg_get_spectrogramconfig_fft_size(this.__wbg_ptr)>>>0}set fft_size(e){r.__wbg_set_spectrogramconfig_fft_size(this.__wbg_ptr,e)}get hop_length(){return r.__wbg_get_spectrogramconfig_hop_length(this.__wbg_ptr)>>>0}set hop_length(e){r.__wbg_set_spectrogramconfig_hop_length(this.__wbg_ptr,e)}get img_width(){return r.__wbg_get_spectrogramconfig_img_width(this.__wbg_ptr)>>>0}set img_width(e){r.__wbg_set_spectrogramconfig_img_width(this.__wbg_ptr,e)}get img_height(){return r.__wbg_get_spectrogramconfig_img_height(this.__wbg_ptr)>>>0}set img_height(e){r.__wbg_set_spectrogramconfig_img_height(this.__wbg_ptr,e)}get gain(){return r.__wbg_get_spectrogramconfig_gain(this.__wbg_ptr)}set gain(e){r.__wbg_set_spectrogramconfig_gain(this.__wbg_ptr,e)}}Symbol.dispose&&(m.prototype[Symbol.dispose]=m.prototype.free);const L=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>r.__wbg_wbg_rayon_poolbuilder_free(n>>>0,1));class c{static __wrap(e){e=e>>>0;const t=Object.create(c.prototype);return t.__wbg_ptr=e,L.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,L.unregister(this),e}free(){const e=this.__destroy_into_raw();r.__wbg_wbg_rayon_poolbuilder_free(e,0)}numThreads(){return r.wbg_rayon_poolbuilder_numThreads(this.__wbg_ptr)>>>0}build(){r.wbg_rayon_poolbuilder_build(this.__wbg_ptr)}receiver(){return r.wbg_rayon_poolbuilder_receiver(this.__wbg_ptr)>>>0}}Symbol.dispose&&(c.prototype[Symbol.dispose]=c.prototype.free);const ee=new Set(["basic","cors","default"]);async function te(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(s){if(n.ok&&ee.has(n.type)&&n.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",s);else throw s}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function ne(n){const e={};return e.wbg={},e.wbg.__wbg___wbindgen_is_undefined_2d472862bd29a478=function(t){return t===void 0},e.wbg.__wbg___wbindgen_memory_27faa6e0e73716bd=function(){return r.memory},e.wbg.__wbg___wbindgen_module_66f1f22805762dd9=function(){return R.__wbindgen_wasm_module},e.wbg.__wbg___wbindgen_throw_b855445ff6a94295=function(t,s){throw new Error(S(t,s))},e.wbg.__wbg_call_e762c39fa8ea36bf=function(){return q(function(t,s){return t.call(s)},arguments)},e.wbg.__wbg_instanceof_Window_4846dbb3de56c84c=function(t){let s;try{s=t instanceof Window}catch{s=!1}return s},e.wbg.__wbg_new_a7442b4b19c1a356=function(t,s){return new Error(S(t,s))},e.wbg.__wbg_new_no_args_ee98eee5275000a4=function(t,s){return new Function(S(t,s))},e.wbg.__wbg_startWorkers_2ca11761e08ff5d5=function(t,s,i){return G(t,s,c.__wrap(i))},e.wbg.__wbg_static_accessor_GLOBAL_89e1d9ac6a1b250e=function(){const t=typeof global>"u"?null:global;return h(t)?0:l(t)},e.wbg.__wbg_static_accessor_GLOBAL_THIS_8b530f326a9e48ac=function(){const t=typeof globalThis>"u"?null:globalThis;return h(t)?0:l(t)},e.wbg.__wbg_static_accessor_SELF_6fdf4b64710cc91b=function(){const t=typeof self>"u"?null:self;return h(t)?0:l(t)},e.wbg.__wbg_static_accessor_WINDOW_b45bfc5a37f6cfa2=function(){const t=typeof window>"u"?null:window;return h(t)?0:l(t)},e.wbg.__wbindgen_init_externref_table=function(){const t=r.__wbindgen_externrefs,s=t.grow(4);t.set(0,void 0),t.set(s+0,void 0),t.set(s+1,null),t.set(s+2,!0),t.set(s+3,!1)},e.wbg.memory=n||new WebAssembly.Memory({initial:18,maximum:16384,shared:!0}),e}function re(n,e,t){if(r=n.exports,R.__wbindgen_wasm_module=e,p=null,b=null,typeof t<"u"&&(typeof t!="number"||t===0||t%65536!==0))throw"invalid stack size";return r.__wbindgen_start(t),r}async function R(n,e){if(r!==void 0)return r;let t;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n,memory:e,thread_stack_size:t}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n>"u"&&(n=new URL(""+new URL("wasm_spectrogram_bg-C6d0pXDS.wasm",import.meta.url).href,import.meta.url));const s=ne(e);(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:i,module:_}=await te(await n,s);return re(i,_,t)}var se=Object.freeze({__proto__:null,SpectrogramConfig:m,default:R,generate_spectrogram_image:D,initThreadPool:P,wbg_rayon_PoolBuilder:c,wbg_rayon_start_worker:Q});const a=self;let w=null,u=0,M=null,T=null;async function ie(){M||(M=(async()=>{await R(),await P(navigator.hardwareConcurrency)})()),await M}a.onmessage=async n=>{await ie();const e=n.data;switch(e.type){case"INIT":w=e.audioData,u=e.sampleRate,T=null,a.postMessage({type:"INIT_COMPLETE"});break;case"SET_PALETTE":T=e.palette;break;case"GET_TILE":{const{reqId:t,params:s}=e;if(!w||!u||!T){a.postMessage({type:"ERROR",reqId:t,message:"Worker not ready"});return}const{startTime:i,endTime:_,gain:g,tileWidthPx:o,height:f}=s,x=Math.floor(i*u),C=Math.ceil(_*u);if(x>=w.length){a.postMessage({type:"ERROR",reqId:t,message:"Out of bounds"});return}const z=w.subarray(x,Math.min(C,w.length)),U=1024,B=64;try{const y=new m(u,U,B,o,f,g),j=D(z,T,y);y.free();const O=new OffscreenCanvas(o,f),v=O.getContext("2d");if(!v)throw new Error("OffscreenCanvas context 失败");const N=new ImageData(new Uint8ClampedArray(j),o,f);v.putImageData(N,0,0);const k=O.transferToImageBitmap();a.postMessage({type:"TILE_READY",reqId:t,imageBitmap:k},[k])}catch(y){a.postMessage({type:"ERROR",reqId:t,message:y.message})}break}}};
//# sourceMappingURL=spectrogram.worker-C0giGhkj.js.map
