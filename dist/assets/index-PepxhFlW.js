import{r as d,c as cn,u as Qn,j as s,a as er,R as tr,A as nr,P as rr,b as st,d as or,C as sr,I as ir,S as cr,e as ar,f as lr,G as dr,L as ur,g as fr,h as mr,i as hr,k as gr,l as pr,m as xr,H as yr,n as ct,v as an,o as ln,p as Q,q as dn,s as wr,t as Pt,w as br,x as un,y as Tr,z as Lr,B as Ve,D as ie,E as Cr,F as vr,J as Te,K as Xe,M as W,N as ae,O as Le,Q as De,T as Ue,U as he,V as dt,W as yt,X as fn,Y as mn,Z as Ce,_ as ze,$ as Mr,a0 as X,a1 as Qt,a2 as ut,a3 as Sr,a4 as hn,a5 as gn,a6 as Er,a7 as Ar,a8 as _r,a9 as Ke,aa as _t,ab as en,ac as qe,ad as jr,ae as wt,af as at,ag as pn,ah as Rr,ai as Nr,aj as Ir,ak as Be,al as jt,am as Wr}from"./index-kOEx1-WA.js";import{D as Pr}from"./chunk-27-B4ZkMXwn.js";var Ft="ContextMenu",[Fr]=er(Ft,[cn]),ge=cn(),[Br,xn]=Fr(Ft),yn=t=>{const{__scopeContextMenu:e,children:n,onOpenChange:r,dir:o,modal:i=!0}=t,[u,c]=d.useState(!1),b=ge(e),y=Qn(r),h=d.useCallback(M=>{c(M),y(M)},[y]);return s.jsx(Br,{scope:e,open:u,onOpenChange:h,modal:i,children:s.jsx(tr,{...b,dir:o,open:u,onOpenChange:h,modal:i,children:n})})};yn.displayName=Ft;var wn="ContextMenuTrigger",bn=d.forwardRef((t,e)=>{const{__scopeContextMenu:n,disabled:r=!1,...o}=t,i=xn(wn,n),u=ge(n),c=d.useRef({x:0,y:0}),b=d.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...c.current})}),y=d.useRef(0),h=d.useCallback(()=>window.clearTimeout(y.current),[]),M=x=>{c.current={x:x.clientX,y:x.clientY},i.onOpenChange(!0)};return d.useEffect(()=>h,[h]),d.useEffect(()=>void(r&&h()),[r,h]),s.jsxs(s.Fragment,{children:[s.jsx(nr,{...u,virtualRef:b}),s.jsx(rr.span,{"data-state":i.open?"open":"closed","data-disabled":r?"":void 0,...o,ref:e,style:{WebkitTouchCallout:"none",...t.style},onContextMenu:r?t.onContextMenu:st(t.onContextMenu,x=>{h(),M(x),x.preventDefault()}),onPointerDown:r?t.onPointerDown:st(t.onPointerDown,pt(x=>{h(),y.current=window.setTimeout(()=>M(x),700)})),onPointerMove:r?t.onPointerMove:st(t.onPointerMove,pt(h)),onPointerCancel:r?t.onPointerCancel:st(t.onPointerCancel,pt(h)),onPointerUp:r?t.onPointerUp:st(t.onPointerUp,pt(h))})]})});bn.displayName=wn;var kr="ContextMenuPortal",Tn=t=>{const{__scopeContextMenu:e,...n}=t,r=ge(e);return s.jsx(or,{...r,...n})};Tn.displayName=kr;var Ln="ContextMenuContent",Cn=d.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=xn(Ln,n),i=ge(n),u=d.useRef(!1);return s.jsx(sr,{...i,...r,ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:c=>{t.onCloseAutoFocus?.(c),!c.defaultPrevented&&u.current&&c.preventDefault(),u.current=!1},onInteractOutside:c=>{t.onInteractOutside?.(c),!c.defaultPrevented&&!o.modal&&(u.current=!0)},style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Cn.displayName=Ln;var Dr="ContextMenuGroup",vn=d.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ge(n);return s.jsx(dr,{...o,...r,ref:e})});vn.displayName=Dr;var Vr="ContextMenuLabel",Mn=d.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ge(n);return s.jsx(ur,{...o,...r,ref:e})});Mn.displayName=Vr;var zr="ContextMenuItem",Sn=d.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ge(n);return s.jsx(ir,{...o,...r,ref:e})});Sn.displayName=zr;var Or="ContextMenuCheckboxItem",En=d.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ge(n);return s.jsx(ar,{...o,...r,ref:e})});En.displayName=Or;var Gr="ContextMenuRadioGroup",An=d.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ge(n);return s.jsx(fr,{...o,...r,ref:e})});An.displayName=Gr;var Zr="ContextMenuRadioItem",_n=d.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ge(n);return s.jsx(mr,{...o,...r,ref:e})});_n.displayName=Zr;var Hr="ContextMenuItemIndicator",jn=d.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ge(n);return s.jsx(lr,{...o,...r,ref:e})});jn.displayName=Hr;var $r="ContextMenuSeparator",Rn=d.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ge(n);return s.jsx(cr,{...o,...r,ref:e})});Rn.displayName=$r;var Ur="ContextMenuArrow",qr=d.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ge(n);return s.jsx(hr,{...o,...r,ref:e})});qr.displayName=Ur;var Kr="ContextMenuSubTrigger",Nn=d.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ge(n);return s.jsx(gr,{...o,...r,ref:e})});Nn.displayName=Kr;var Xr="ContextMenuSubContent",In=d.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,o=ge(n);return s.jsx(pr,{...o,...r,ref:e,style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});In.displayName=Xr;function pt(t){return e=>e.pointerType!=="mouse"?t(e):void 0}var Yr=yn,Jr=bn,Wn=Tn,Qr=Cn,eo=vn,to=Mn,no=Sn,ro=En,oo=An,so=_n,Pn=jn,io=Rn,co=Nn,ao=In;const ft=t=>d.createElement(Yr,{...t});ft.displayName="ContextMenu.Root";const mt=d.forwardRef(({children:t,...e},n)=>d.createElement(Jr,{...e,ref:n,asChild:!0},xr(t)));mt.displayName="ContextMenu.Trigger";const Fn=d.createContext({}),ht=d.forwardRef((t,e)=>{const n=yr(),{size:r=ct.size.default,variant:o=ct.variant.default,highContrast:i=ct.highContrast.default}=t,{className:u,children:c,color:b,container:y,forceMount:h,...M}=an(t,ct),x=b||n.accentColor;return d.createElement(Wn,{container:y,forceMount:h},d.createElement(ln,{asChild:!0},d.createElement(Qr,{"data-accent-color":x,alignOffset:-Number(r)*4,collisionPadding:10,...M,asChild:!1,ref:e,className:Q("rt-PopperContent","rt-BaseMenuContent","rt-ContextMenuContent",u)},d.createElement(dn,{type:"auto"},d.createElement("div",{className:Q("rt-BaseMenuViewport","rt-ContextMenuViewport")},d.createElement(Fn.Provider,{value:d.useMemo(()=>({size:r,variant:o,color:x,highContrast:i}),[r,o,x,i])},c))))))});ht.displayName="ContextMenu.Content";const lo=d.forwardRef(({className:t,...e},n)=>d.createElement(to,{...e,asChild:!1,ref:n,className:Q("rt-BaseMenuLabel","rt-ContextMenuLabel",t)}));lo.displayName="ContextMenu.Label";const Se=d.forwardRef((t,e)=>{const{className:n,children:r,color:o=wr.color.default,shortcut:i,...u}=t;return d.createElement(no,{"data-accent-color":o,...u,ref:e,className:Q("rt-reset","rt-BaseMenuItem","rt-ContextMenuItem",n)},d.createElement(Pt,null,r),i&&d.createElement("div",{className:"rt-BaseMenuShortcut rt-ContextMenuShortcut"},i))});Se.displayName="ContextMenu.Item";const uo=d.forwardRef(({className:t,...e},n)=>d.createElement(eo,{...e,asChild:!1,ref:n,className:Q("rt-BaseMenuGroup","rt-ContextMenuGroup",t)}));uo.displayName="ContextMenu.Group";const fo=d.forwardRef(({className:t,...e},n)=>d.createElement(oo,{...e,asChild:!1,ref:n,className:Q("rt-BaseMenuRadioGroup","rt-ContextMenuRadioGroup",t)}));fo.displayName="ContextMenu.RadioGroup";const mo=d.forwardRef((t,e)=>{const{children:n,className:r,color:o=Tr.color.default,...i}=t;return d.createElement(so,{...i,asChild:!1,ref:e,"data-accent-color":o,className:Q("rt-BaseMenuItem","rt-BaseMenuRadioItem","rt-ContextMenuItem","rt-ContextMenuRadioItem",r)},d.createElement(Pt,null,n),d.createElement(Pn,{className:"rt-BaseMenuItemIndicator rt-ContextMenuItemIndicator"},d.createElement(un,{className:"rt-BaseMenuItemIndicatorIcon rt-ContextMenuItemIndicatorIcon"})))});mo.displayName="ContextMenu.RadioItem";const Wt=d.forwardRef((t,e)=>{const{children:n,className:r,shortcut:o,color:i=br.color.default,...u}=t;return d.createElement(ro,{...u,asChild:!1,ref:e,"data-accent-color":i,className:Q("rt-BaseMenuItem","rt-BaseMenuCheckboxItem","rt-ContextMenuItem","rt-ContextMenuCheckboxItem",r)},d.createElement(Pt,null,n),d.createElement(Pn,{className:"rt-BaseMenuItemIndicator rt-ContextMenuItemIndicator"},d.createElement(un,{className:"rt-BaseMenuItemIndicatorIcon rt-ContextMenuItemIndicatorIcon"})),o&&d.createElement("div",{className:"rt-BaseMenuShortcut rt-ContextMenuShortcut"},o))});Wt.displayName="ContextMenu.CheckboxItem";const ho=d.forwardRef((t,e)=>{const{className:n,children:r,...o}=t;return d.createElement(co,{...o,asChild:!1,ref:e,className:Q("rt-BaseMenuItem","rt-BaseMenuSubTrigger","rt-ContextMenuItem","rt-ContextMenuSubTrigger",n)},r,d.createElement("div",{className:"rt-BaseMenuShortcut rt-ContextMenuShortcut"},d.createElement(Lr,{className:"rt-BaseMenuSubTriggerIcon rt-ContextMenuSubTriggerIcon"})))});ho.displayName="ContextMenu.SubTrigger";const go=d.forwardRef((t,e)=>{const{size:n,variant:r,color:o,highContrast:i}=d.useContext(Fn),{className:u,children:c,container:b,forceMount:y,...h}=an({size:n,variant:r,color:o,highContrast:i,...t},ct);return d.createElement(Wn,{container:b,forceMount:y},d.createElement(ln,{asChild:!0},d.createElement(ao,{"data-accent-color":o,alignOffset:-Number(n)*4,sideOffset:1,collisionPadding:10,...h,asChild:!1,ref:e,className:Q("rt-PopperContent","rt-BaseMenuContent","rt-BaseMenuSubContent","rt-ContextMenuContent","rt-ContextMenuSubContent",u)},d.createElement(dn,{type:"auto"},d.createElement("div",{className:Q("rt-BaseMenuViewport","rt-ContextMenuViewport")},c)))))});go.displayName="ContextMenu.SubContent";const bt=d.forwardRef(({className:t,...e},n)=>d.createElement(io,{...e,asChild:!1,ref:n,className:Q("rt-BaseMenuSeparator","rt-ContextMenuSeparator",t)}));bt.displayName="ContextMenu.Separator";const po=Ve("PaddingLeftRegular","1em",["M2 3.5a.5.5 0 0 1 1 0v1a.5.5 0 0 1-1 0v-1Zm0 3a.5.5 0 0 1 1 0v2a.5.5 0 0 1-1 0v-2Zm0 4a.5.5 0 0 1 1 0v2a.5.5 0 0 1-1 0v-2Zm0 4a.5.5 0 0 1 1 0v1a.5.5 0 0 1-1 0v-1Zm2.15-4.65a.5.5 0 0 1 0-.7l4.5-4.5a.5.5 0 1 1 .7.7L5.71 9h9.79a.5.5 0 0 1 0 1H5.7l3.65 3.65a.5.5 0 0 1-.7.7l-4.5-4.5ZM17 3.5a.5.5 0 0 1 1 0v12a.5.5 0 0 1-1 0v-12Z"]),xo=Ve("PaddingRightRegular","1em",["M15.85 9.85a.5.5 0 0 0 0-.7l-4.5-4.5a.5.5 0 0 0-.7.7L14.29 9H4.5a.5.5 0 0 0 0 1h9.8l-3.65 3.65a.5.5 0 0 0 .7.7l4.5-4.5ZM3 3.5a.5.5 0 0 0-1 0v12a.5.5 0 0 0 1 0v-12Zm15 0a.5.5 0 0 0-1 0v1a.5.5 0 0 0 1 0v-1Zm0 3a.5.5 0 0 0-1 0v2a.5.5 0 0 0 1 0v-2Zm0 4a.5.5 0 0 0-1 0v2a.5.5 0 0 0 1 0v-2Zm0 4a.5.5 0 0 0-1 0v1a.5.5 0 0 0 1 0v-1Z"]),yo=Ve("CutRegular","1em",["M5.92 2.23a.5.5 0 0 0-.84.54L9.4 9.43l-1.92 2.96a3 3 0 1 0 .78.64L10 10.35l1.74 2.68a3 3 0 1 0 .78-.64L5.92 2.23ZM14 17a2 2 0 1 1 0-4 2 2 0 0 1 0 4ZM4 15a2 2 0 1 1 4 0 2 2 0 0 1-4 0Zm7.2-6.49-.6-.92 3.48-5.36a.5.5 0 0 1 .84.54l-3.73 5.74Z"]),wo=Ve("TaskListLtrRegular","1em",["M5.85 4.35a.5.5 0 1 0-.7-.7L3.5 5.29l-.65-.64a.5.5 0 1 0-.7.7l1 1c.2.2.5.2.7 0l2-2ZM8.5 5a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1h-9Zm0 5a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1h-9ZM8 15.5c0-.28.22-.5.5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5ZM5.85 9.85a.5.5 0 1 0-.7-.7L3.5 10.79l-.65-.64a.5.5 0 0 0-.7.7l1 1c.2.2.5.2.7 0l2-2Zm0 4.3c.2.2.2.5 0 .7l-2 2a.5.5 0 0 1-.7 0l-1-1a.5.5 0 0 1 .7-.7l.65.64 1.65-1.64c.2-.2.5-.2.7 0Z"]),bo=Ve("VideoBackgroundEffectFilled","1em",["M6.2 4 2 8.2V6.8L4.8 4h1.4Zm7 0-1.46 1.46a3.48 3.48 0 0 0-1.02-.39L11.79 4h1.42Zm-1.08 3.17a2.51 2.51 0 0 0-2.34-1.16 2.5 2.5 0 1 0 2.34 1.16Zm.72-.72c.2.29.37.6.48.94L16.69 4 16.5 4h-1.2l-2.46 2.45ZM7.5 12c-.08 0-.15 0-.22.02A1.5 1.5 0 0 0 6 13.5V16h8v-2.5a1.5 1.5 0 0 0-1.5-1.5h-5Zm5-1c.22 0 .43.03.63.08L18 6.2V5.5c0-.2-.04-.4-.12-.59l-4.5 4.5a3.5 3.5 0 0 1-.93 1.59h.05Zm1.9.88c.23.27.4.58.5.93L18 9.7V8.29l-3.6 3.6ZM15 16v-1.2l3-3v1.4L15.2 16H15Zm-10-.3v-1.4l-1.7 1.69.2.01h1.2l.3-.3Zm1.57-6.48c.08.36.21.7.4 1.02L2.11 15.1A1.5 1.5 0 0 1 2 14.5v-.7l4.57-4.58ZM9.71 4 2 11.7v-1.4L8.3 4h1.4Z"]),To=Ve("SplitVerticalRegular","1em",["M10 2.5a.5.5 0 0 0-1 0v15a.5.5 0 0 0 1 0v-15ZM4 4a2 2 0 0 0-2 2v8c0 1.1.9 2 2 2h4v-1H4a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h4V4H4Zm7 0v1h4a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1h-4v1h4a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-4Z"]),Lo=Ve("TextAlignRightFilled","1em",["M6 4.25c0-.41.34-.75.75-.75h10.5a.75.75 0 0 1 0 1.5H6.75A.75.75 0 0 1 6 4.25Zm-4 5c0-.41.34-.75.75-.75h14.5a.75.75 0 0 1 0 1.5H2.75A.75.75 0 0 1 2 9.25Zm7.75 4.25a.75.75 0 0 0 0 1.5h7.5a.75.75 0 0 0 0-1.5h-7.5Z"]),Ne=t=>t,Bt=t=>({_tag:"Left",value:t}),Tt=t=>({_tag:"Right",value:t}),Co=(t,e,n)=>n._tag==="Left"?t(n.value):e(n.value),Bn={dimap:(t,e,n)=>r=>e(n(t(r))),first:t=>([e,n])=>[t(e),n],right:t=>e=>e._tag==="Left"?e:Tt(t(e.value)),wander:t=>e=>e.map(t)},vo={empty:()=>{},foldMap:(t,e)=>{for(let n=0;n<e.length;n++){const r=t(e[n]);if(r!=null)return r}}},Mo={empty:()=>[],foldMap:(t,e)=>{let n=[];return e.forEach(r=>{n=n.concat(t(r))}),n}},kt=t=>({dimap:(e,n,r)=>o=>r(e(o)),first:e=>([n,r])=>e(n),right:e=>n=>n._tag==="Left"?t.empty():e(n.value),wander:e=>n=>t.foldMap(e,n)}),Rt={Equivalence:{Equivalence:"Equivalence",Iso:"Iso",Lens:"Lens",Prism:"Prism",Traversal:"Traversal",Getter:"Getter",AffineFold:"AffineFold",Fold:"Fold",Setter:"Setter"},Iso:{Equivalence:"Iso",Iso:"Iso",Lens:"Lens",Prism:"Prism",Traversal:"Traversal",Getter:"Getter",AffineFold:"AffineFold",Fold:"Fold",Setter:"Setter"},Lens:{Equivalence:"Lens",Iso:"Lens",Lens:"Lens",Prism:"Prism",Traversal:"Traversal",Getter:"Getter",AffineFold:"AffineFold",Fold:"Fold",Setter:"Setter"},Prism:{Equivalence:"Prism",Iso:"Prism",Lens:"Prism",Prism:"Prism",Traversal:"Traversal",Getter:"AffineFold",AffineFold:"AffineFold",Fold:"Fold",Setter:"Setter"},Traversal:{Equivalence:"Traversal",Iso:"Traversal",Lens:"Traversal",Prism:"Traversal",Traversal:"Traversal",Getter:"Fold",AffineFold:"Fold",Fold:"Fold",Setter:"Setter"},Getter:{Equivalence:"Getter",Iso:"Getter",Lens:"Getter",Prism:"AffineFold",Traversal:"Fold",Getter:"Getter",AffineFold:"AffineFold",Fold:"Fold",Setter:void 0},AffineFold:{Equivalence:"AffineFold",Iso:"AffineFold",Lens:"AffineFold",Prism:"AffineFold",Traversal:"Fold",Getter:"AffineFold",AffineFold:"AffineFold",Fold:"Fold",Setter:void 0},Fold:{Equivalence:"Fold",Iso:"Fold",Lens:"Fold",Prism:"Fold",Traversal:"Fold",Getter:"Fold",AffineFold:"Fold",Fold:"Fold",Setter:void 0},Setter:{Equivalence:void 0,Iso:void 0,Lens:void 0,Prism:void 0,Traversal:void 0,Getter:void 0,AffineFold:void 0,Fold:void 0,Setter:void 0}},Ye=(t,e)=>{const n=e;return n._tag=t,n},kn=t=>(t._removable=!0,t);function G(t,e,n){switch(arguments.length){case 2:{const r=(o,i)=>t(o,e(o,i));return r._tag=Rt[t._tag][e._tag],r._removable=e._removable||!1,r}default:{const r=Rt[t._tag][e._tag],o=(i,u)=>t(i,e(i,n(i,u)));return o._tag=Rt[r][n._tag],o._removable=n._removable||!1,o}}}const So=Ye("Equivalence",(t,e)=>e),Lt=(t,e)=>Ye("Iso",(n,r)=>n.dimap(t,e,r)),ye=(t,e)=>Ye("Lens",(n,r)=>n.dimap(o=>[t(o),o],e,n.first(r))),Dt=(t,e)=>Ye("Prism",(n,r)=>n.dimap(t,o=>Co(Ne,e,o),n.right(r))),Vt=Ye("Traversal",(t,e)=>t.dimap(Ne,Ne,t.wander(e))),Eo=t=>Ye("Getter",(e,n)=>e.dimap(t,Ne,n)),Dn=(t,e,n)=>t(Bn,e)(n),Ao=(t,e,n)=>t(Bn,()=>e)(n),_o=(t,e)=>t(kt({}),Ne)(e),jo=(t,e)=>t(kt(vo),Ne)(e),Vn=(t,e)=>t(kt(Mo),n=>[n])(e),Ro=Lt(t=>t.map((e,n)=>[n,e]),t=>{const e=[...t].sort((r,o)=>r[0]-o[0]),n=[];for(let r=0;r<e.length;++r)(r===e.length-1||e[r][0]!==e[r+1][0])&&n.push(e[r][1]);return n}),tn=t=>ye(e=>e[t],([e,n])=>Object.assign(Object.assign({},n),{[t]:e})),No=t=>ye(e=>{const n={};for(const r of t)n[r]=e[r];return n},([e,n])=>{const r=Object.assign({},n);for(const o of t)delete r[o];return Object.assign(r,e)}),zn=t=>ye(e=>e[t],([e,n])=>{const r=n.slice();return r[t]=e,r}),zt=zn(0),Ot=t=>Dt(e=>t(e)?Tt(e):Bt(e),Ne),lt=Symbol("__no_match__"),On=Ot(t=>t!==lt),Gn=Symbol("__remove_me__"),Nt=t=>kn(G(ye(e=>0<=t&&t<e.length?e[t]:lt,([e,n])=>{if(e===lt)return n;if(e===Gn)return typeof n=="string"?n.substring(0,t)+n.substring(t+1):[...n.slice(0,t),...n.slice(t+1)];if(typeof n=="string")return t===0?e+n.substring(1):t===n.length?n.substring(0,t-1)+e:n.substring(0,t)+e+n.substring(t+1);{const r=n.slice();return r[t]=e,r}}),On)),Io=Dt(t=>t===void 0?Bt(void 0):Tt(t),Ne),Wo=t=>Dt(e=>t(e)?Tt(e):Bt(e),Ne),Po=t=>kn(G(ye(e=>{const n=e.findIndex(t);return n===-1?[lt,-1]:[e[n],n]},([[e,n],r])=>{if(e===lt)return r;if(e===Gn)return[...r.slice(0,n),...r.slice(n+1)];const o=r.slice();return o[n]=e,o}),zt,On)),Fo=t=>G(ye(e=>{const n=e.map((r,o)=>t(r)?o:null).filter(r=>r!=null);return[n.map(r=>e[r]),n]},([[e,n],r])=>{const o=r.length,i=e.length;let u=0,c=0,b=0;const y=[];for(;u<o;)n[c]===u?(++c,b<i&&(y.push(e[b]),++b)):y.push(r[u]),++u;for(;b<i;)y.push(e[b++]);return y}),zt),Bo=t=>ye(e=>e===void 0?t:e,([e,n])=>e),ko=t=>G(ye(e=>{const n=Vn(t,e);return[n,n.length]},([[e,n],r])=>{if(e.length!==n)throw new Error("cannot add/remove elements through partsOf");let o=0;return Dn(t,()=>e[o++],r)}),zt),Do=t=>ye(e=>t(e),([e,n])=>e),Vo=t=>ye(e=>e,([e,n])=>t(e)),zo=ye(t=>{},([t,e])=>t===void 0?e:[t,...e]),Oo=ye(t=>{},([t,e])=>t===void 0?e:[...e,t]),Go=G(Lt(t=>t.split(""),t=>t.join("")),Vt),Zo=G(Lt(t=>t.split(/\b/),t=>t.join("")),Vt,Ot(t=>!/\s+/.test(t)));class q{constructor(e){this._ref=e}get _tag(){return this._ref._tag}get _removable(){return this._ref._removable}compose(e){return new q(G(this._ref,e._ref))}iso(e,n){return new q(G(this._ref,Lt(e,n)))}lens(e,n){return new q(G(this._ref,ye(e,([r,o])=>n(o,r))))}indexed(){return new q(G(this._ref,Ro))}prop(e){return new q(G(this._ref,tn(e)))}path(...e){return e.length===1&&(e=e[0].split(".")),new q(e.reduce((n,r)=>G(n,tn(r)),this._ref))}pick(e){return new q(G(this._ref,No(e)))}nth(e){return new q(G(this._ref,zn(e)))}filter(e){return new q(G(this._ref,Fo(e)))}valueOr(e){return new q(G(this._ref,Bo(e)))}partsOf(e){const n=typeof e=="function"?e(Zn):e;return new q(G(this._ref,ko(n._ref)))}reread(e){return new q(G(this._ref,Do(e)))}rewrite(e){return new q(G(this._ref,Vo(e)))}optional(){return new q(G(this._ref,Io))}guard_(){return e=>this.guard(e)}guard(e){return new q(G(this._ref,Wo(e)))}at(e){return new q(G(this._ref,Nt(e)))}head(){return new q(G(this._ref,Nt(0)))}index(e){return new q(G(this._ref,Nt(e)))}find(e){return new q(G(this._ref,Po(e)))}elems(){return new q(G(this._ref,Vt))}to(e){return new q(G(this._ref,Eo(e)))}when(e){return new q(G(this._ref,Ot(e)))}chars(){return new q(G(this._ref,Go))}words(){return new q(G(this._ref,Zo))}prependTo(){return new q(G(this._ref,zo))}appendTo(){return new q(G(this._ref,Oo))}}const Zn=new q(So);function Ho(){return Zn}function $o(t){return e=>_o(t._ref,e)}function Uo(t){return e=>jo(t._ref,e)}function qo(t){return e=>Vn(t._ref,e)}function Ko(t){return e=>n=>Dn(t._ref,e,n)}function Xo(t){return e=>n=>Ao(t._ref,e,n)}const nn=(t,e,n)=>(e.has(n)?e:e.set(n,t())).get(n),Yo=new WeakMap,Jo=(t,e,n)=>{const r=nn(()=>new WeakMap,Yo,e);return nn(t,r,n)},Qo=t=>typeof t=="function";function es(t,e){return Jo(()=>{const n=e(Ho());return ie(o=>{const i=o(t);return i instanceof Promise?i.then(u=>rn(n,u)):rn(n,i)},(o,i,u)=>{const c=Qo(u)?Ko(n)(u):Xo(n)(u),b=o(t);return i(t,b instanceof Promise?b.then(c):c(b))})},t,e)}const rn=(t,e)=>t._tag==="Traversal"?qo(t)(e):t._tag==="Prism"?Uo(t)(e):$o(t)(e);var it={},on;function ts(){if(on)return it;on=1,Object.defineProperty(it,"__esModule",{value:!0}),it.ViewportList=void 0;const t=Cr(),e=vr(),n=typeof window>"u",r=!n&&(()=>{try{return"ontouchstart"in window||navigator.maxTouchPoints}catch{return!1}})(),o=!n&&(()=>{try{return window.CSS.supports("overflow-anchor: auto")}catch{return!1}})(),i=r&&!o,u={top:"top",bottom:"bottom",clientHeight:"clientHeight",scrollHeight:"scrollHeight",scrollTop:"scrollTop",overflowY:"overflowY",height:"height",minHeight:"minHeight",maxHeight:"maxHeight",marginTop:"marginTop"},c={top:"left",bottom:"right",scrollHeight:"scrollWidth",clientHeight:"clientWidth",scrollTop:"scrollLeft",overflowY:"overflowX",minHeight:"minWidth",height:"width",maxHeight:"maxWidth",marginTop:"marginLeft"},b=(a,T,p=1/0)=>Math.max(Math.min(T,p),a),y=(a,T,p)=>Math.ceil(Math.abs(a-T)/p),h=n?e.useEffect:e.useLayoutEffect,M=(a,T,p)=>{const S=[];for(let _=a;_<T;_++)S.push(p(_));return S},x=({fromElement:a,toElement:T,fromIndex:p,asc:S=!0,compare:_})=>{let j=p,A=a;for(;A&&A!==T;){if(_(A,j))return[A,j];S?(j++,A=A.nextSibling):(j--,A=A.previousSibling)}return[null,-1]},g=/auto|scroll/gi,L=(a,T)=>{if(!T||T===document.body||T===document.documentElement)return document.documentElement;const p=window.getComputedStyle(T);return g.test(p[a.overflowY])||g.test(p.overflow)?T:L(a,T.parentNode)},C=(a,T,p=0)=>({padding:0,margin:0,border:"none",visibility:"hidden",overflowAnchor:"none",[a.minHeight]:T,[a.height]:T,[a.maxHeight]:T,[a.marginTop]:p}),m=({items:a=[],count:T,children:p,viewportRef:S,itemSize:_=0,itemMargin:j=-1,overscan:A=1,axis:P="y",initialIndex:f=-1,initialAlignToTop:w=!0,initialOffset:v=0,initialDelay:N=-1,initialPrerender:B=0,onViewportIndexesChange:V,overflowAnchor:U="auto",withCache:Z=!0,scrollThreshold:I=0,renderSpacer:z=({ref:l,style:D})=>(0,t.jsx)("div",{ref:l,style:D}),indexesShift:F=0,getItemBoundingClientRect:k=l=>l.getBoundingClientRect()},ee)=>{const l=P==="y"?u:c,D=typeof T=="number",O=(D?T:a.length)-1,[[te,ue],Ee]=(0,e.useState)(()=>[b(0,_),b(-1,j)]),H=b(0,te+ue),fe=b(0,Math.ceil(A*H)),[Y,ve]=(0,e.useState)([f-B,f+B]),we=(0,e.useRef)(null),pe=(0,e.useRef)(-1),Me=(0,e.useRef)(null),Ae=(0,e.useRef)(null),Je=(0,e.useRef)(!1),qt=(0,e.useRef)(F),Qe=(0,e.useRef)([]),Ie=(0,e.useRef)(f>=0?{index:f,alignToTop:w,offset:v,delay:N,prerender:B}:null),et=(0,e.useRef)(null),je=(0,e.useRef)(0),gt=(0,e.useRef)([-1,-1]),tt=(0,e.useRef)(null),[J,le]=(0,e.useMemo)(()=>{Y[0]=b(0,Y[0],O),Y[1]=b(Y[0],Y[1],O);const R=F-qt.current;qt.current=F;const $=Me.current;return $&&R&&(Y[0]=b(0,Y[0]+R,O),Y[1]=b(Y[0],Y[1]+R,O),we.current=$.nextSibling,pe.current=Y[0],Je.current=!0),Y},[F,Y,O]),Un=(0,e.useMemo)(()=>C(l,(Z?Qe.current:[]).slice(0,J).reduce((R,$)=>R+($-te),J*H),je.current),[l,Z,J,H,te]),qn=(0,e.useMemo)(()=>C(l,(Z?Qe.current:[]).slice(le+1,O+1).reduce((R,$)=>R+($-te),H*(O-le))),[l,Z,le,O,H,te]),Oe=(0,e.useMemo)(()=>{let R=null;return()=>{if(S)return S.current===document.body?document.documentElement:S.current;if(R&&R.isConnected)return R;const $=Me.current;return $?(R=L(l,$.parentNode),R):null}},[l,S]),Mt=(0,e.useRef)(()=>{}),Kt=(0,e.useRef)(()=>({index:-1,offset:0}));h(()=>{Mt.current=()=>{const R=Oe(),$=Me.current,ne=Ae.current;if(!R||!$||!ne)return;const oe=$.nextSibling,me=ne.previousSibling,_e=R.getBoundingClientRect(),ce=$.getBoundingClientRect(),se=ne.getBoundingClientRect(),xe={[l.top]:R===document.documentElement?0:_e[l.top],[l.bottom]:R===document.documentElement?document.documentElement[l.clientHeight]:_e[l.bottom]},re={[l.top]:xe[l.top]-fe,[l.bottom]:xe[l.bottom]+fe};if(je.current<0&&ce[l.top]-je.current>=re[l.top]||je.current>0&&ce[l.top]>=re[l.top]||je.current&&Ie.current){$.style[l.marginTop]="0px",R.style[l.overflowY]="hidden",R[l.scrollTop]+=-je.current,R.style[l.overflowY]="",je.current=0;return}if(te===0||ue===-1){let K=0;if(x({fromElement:oe,toElement:ne,fromIndex:J,compare:Fe=>(K+=k(Fe)[l.height],!1)}),!K)return;const de=le-J+1,Re=te===0?Math.ceil(K/de):te,Pe=ue===-1?Math.ceil((se[l.top]-ce[l.bottom]-K)/de):ue;Ee([Re,Pe]);return}if(et.current)return;if(Ie.current){const K=b(0,Ie.current.index,O);if(K<J||K>le){ve([K-Ie.current.prerender,K+Ie.current.prerender]);return}const[de]=x({fromElement:oe,toElement:ne,fromIndex:J,compare:(Et,At)=>At===K});if(!de)return;const{alignToTop:Re,offset:Pe,delay:Fe}=Ie.current;Ie.current=null;const Yt=()=>{const Et=k(de),At=Re?Et[l.top]-xe[l.top]+Pe:Et[l.bottom]-xe[l.top]-R[l.clientHeight]+Pe;R[l.scrollTop]+=At,et.current=null},Jt=Fe<0&&i?30:Fe;if(Jt>0){et.current=setTimeout(Yt,Jt);return}Yt();return}if(tt.current===null)tt.current=R.scrollTop;else if(tt.current!==R.scrollTop){const K=Math.abs(R.scrollTop-tt.current);if(tt.current=R.scrollTop,I>0&&K>I)return}const nt=oe===ne?ne:oe.nextSibling,Xt=me===$?$:me.previousSibling,Ge=Math.ceil((se[l.top]-ce[l.bottom])/(le+1-J)),rt=ce[l.bottom]>re[l.bottom],ot=se[l.top]<re[l.top],Kn=!rt&&!ot&&ce[l.bottom]>re[l.top],Xn=!rt&&!ot&&se[l.top]<re[l.bottom],Yn=!rt&&!ot&&(Xt===$?ce:k(Xt))[l.bottom]>re[l.bottom],Jn=!rt&&!ot&&(nt===ne?se:k(nt))[l.top]<re[l.top];let be=J,We=le;if(rt&&(be-=y(ce[l.bottom],re[l.top],Ge),We-=y(se[l.top],re[l.bottom],Ge)),ot&&(We+=y(se[l.top],re[l.bottom],Ge),be+=y(ce[l.bottom],re[l.top],Ge)),Kn&&(be-=y(ce[l.bottom],re[l.top],Ge)),Xn&&(We+=y(se[l.top],re[l.bottom],Ge)),Yn){const[,K]=x({fromElement:me,toElement:$,fromIndex:le,asc:!1,compare:de=>k(de)[l.bottom]<=re[l.bottom]});K!==-1&&(We=K+1)}if(Jn){const[,K]=x({fromElement:oe,toElement:ne,fromIndex:J,compare:de=>k(de)[l.top]>=re[l.top]});K!==-1&&(be=K-1)}if(V){let[,K]=x({fromElement:oe,toElement:ne,fromIndex:J,compare:Re=>k(Re)[l.bottom]>xe[l.top]});K===-1&&(K=J);let[,de]=x({fromElement:me,toElement:$,fromIndex:le,asc:!1,compare:Re=>k(Re)[l.top]<xe[l.bottom]});de===-1&&(de=le),(K!==gt.current[0]||de!==gt.current[1])&&(gt.current=[K,de],V(gt.current))}if(be=b(0,be,O),We=b(be,We,O),!(be===J&&We===le)){if(be!==J)if(J>=be)we.current=oe,pe.current=J;else{const[K,de]=x({fromElement:oe,toElement:ne,fromIndex:J,compare:(Re,Pe)=>{if(Pe===be)return!0;const Fe=k(Re);return Fe[l.height]!==te&&(Qe.current[Pe]=Fe[l.height]),!1}});K?(we.current=K,pe.current=de):(we.current=me,pe.current=le)}ve([be,We])}},Kt.current=()=>{const R=Oe(),$=Me.current,ne=Ae.current;let oe=-1,me=0;if(!R||!$||!ne)return{index:oe,offset:me};const _e=$.nextSibling,ce=R.getBoundingClientRect(),se={[l.top]:R===document.documentElement?0:ce[l.top],[l.bottom]:R===document.documentElement?document.documentElement[l.clientHeight]:ce[l.bottom]};return x({fromElement:_e,toElement:ne,fromIndex:J,compare:(xe,re)=>{const nt=k(xe);return oe=re,me=se[l.top]-nt[l.top],nt[l.bottom]>se[l.top]}}),{index:oe,offset:me}}});let St;return we.current&&Oe()&&Me.current&&(St=k(we.current)[l.top]-(Oe()===document.documentElement?0:Oe().getBoundingClientRect()[l.top])),h(()=>{we.current=null;const R=pe.current,$=Je.current;pe.current=-1,Je.current=!1;const ne=Oe(),oe=Me.current,me=Ae.current;if(R===-1||!ne||!oe||!me||St===void 0||o&&U!=="none"&&!$)return;let _e=null;if(R>=J&&R<=le){const[se]=x({fromElement:oe.nextSibling,toElement:me,fromIndex:J,compare:(xe,re)=>re===R});se&&(_e=k(se)[l.top])}else R<J?_e=oe.getBoundingClientRect()[l.top]+(Z?Qe.current:[]).slice(0,R).reduce((se,xe)=>se+(xe-te),R*H):R<=O&&(_e=me.getBoundingClientRect()[l.top]+(Z?Qe.current:[]).slice(le+1,R).reduce((se,xe)=>se+(xe-te),H*(R-1-le)));if(_e===null)return;const ce=_e-(ne===document.documentElement?0:ne.getBoundingClientRect()[l.top])-St;if(ce){if(r){je.current-=ce,oe.style[l.marginTop]=`${je.current}px`;return}ne[l.scrollTop]+=ce}},[J]),h(()=>{let R;const $=()=>{R=requestAnimationFrame($),Mt.current()};return $(),()=>{cancelAnimationFrame(R),et.current&&clearTimeout(et.current)}},[]),(0,e.useImperativeHandle)(ee,()=>({scrollToIndex:({index:R=-1,alignToTop:$=!0,offset:ne=0,delay:oe=-1,prerender:me=0})=>{Ie.current={index:R,alignToTop:$,offset:ne,delay:oe,prerender:me},Mt.current()},getScrollPosition:()=>Kt.current()}),[]),(0,t.jsxs)(e.Fragment,{children:[z({ref:Me,style:Un,type:"top"}),(!!T||!!a.length)&&M(J,le+1,D?p:R=>p(a[R],R,a)),z({ref:Ae,style:qn,type:"bottom"})]})};return it.ViewportList=(0,e.forwardRef)(m),it}var ns=ts();globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const Ze=globalThis.jotaiAtomCache.get("C:\\Users\\Client\\Desktop\\amll-ttml-tool-main\\src\\components\\LyricLinesView\\lyric-line-view-states.ts/draggingIdAtom",ie(""));Ze.debugLabel="draggingIdAtom";Ze.debugLabel="draggingIdAtom";const rs="_lyricWord_o95th_12",os="_edit_o95th_13",ss="_sync_o95th_22",is="_dropLeft_o95th_31",cs="_dropRight_o95th_35",as="_advance_o95th_39",ls="_wordGroup_o95th_49",ds="_advanceBar_o95th_58",us="_displayWord_o95th_67",fs="_startTime_o95th_71",ms="_endTime_o95th_72",hs="_lyricLine_o95th_102",gs="_dropTop_o95th_113",ps="_dropBottom_o95th_117",xs="_ignoreSync_o95th_121",ys="_insertWordField_o95th_131",ws="_empty_o95th_144",bs="_lyricLineContainer_o95th_149",Ts="_lyricWordsContainer_o95th_161",Ls="_hideTimestamps_o95th_185",Cs="_blank_o95th_206",vs="_error_o95th_210",Ms="_selected_o95th_216",Ss="_active_o95th_260",Es="_lineNumber_o95th_268",As="_ignored_o95th_293",E={lyricWord:rs,edit:os,sync:ss,dropLeft:is,dropRight:cs,advance:as,wordGroup:ls,advanceBar:ds,displayWord:us,startTime:fs,endTime:ms,lyricLine:hs,dropTop:gs,dropBottom:ps,ignoreSync:xs,insertWordField:ys,empty:ws,lyricLineContainer:bs,lyricWordsContainer:Ts,hideTimestamps:Ls,blank:Cs,error:vs,selected:Ms,active:Ss,lineNumber:Es,ignored:As};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const Gt=globalThis.jotaiAtomCache.get("C:\\Users\\Client\\Desktop\\amll-ttml-tool-main\\src\\components\\LyricLinesView\\lyric-line-menu.tsx/selectedLinesSizeAtom",ie(t=>t(Te).size));Gt.debugLabel="selectedLinesSizeAtom";Gt.debugLabel="selectedLinesSizeAtom";const Ct=({lineIndex:t})=>{const{t:e}=Xe(),n=W(Gt),r=W(Te),o=ae(Le),i=W(Le),u=i.lyricLines.filter(m=>r.has(m.id)),[c,b]=d.useState(()=>u.every(m=>m.isBG)?!0:u.every(m=>!m.isBG)?!1:"indeterminate"),[y,h]=d.useState(()=>u.every(m=>m.isDuet)?!0:u.every(m=>!m.isDuet)?!1:"indeterminate"),M=(()=>{if(n<2)return null;const m=i.lyricLines.filter(p=>r.has(p.id)).map(p=>i.lyricLines.indexOf(p)),a=Math.min(...m),T=Math.max(...m);if(m.length!==T-a+1)return null;for(let p=a;p<=T;p++)if(!m.includes(p))return null;return{minIdx:a,maxIdx:T}})();function x(m){b(m),o(a=>{const T=a.lyricLines.filter(p=>r.has(p.id));for(const p of T)p.isBG=m})}function g(m){h(m),o(a=>{const T=a.lyricLines.filter(p=>r.has(p.id));for(const p of T)p.isDuet=m})}return s.jsxs(s.Fragment,{children:[s.jsx(Wt,{checked:c,onCheckedChange:x,children:e("contextMenu.bgLyric","背景歌词")}),s.jsx(Wt,{checked:y,onCheckedChange:g,children:e("contextMenu.duetLyric","对唱歌词")}),s.jsx(bt,{}),s.jsx(Se,{onSelect:()=>{o(m=>{m.lyricLines.splice(t,0,De())})},children:e("contextMenu.insertLineBefore","在前插入空行")}),s.jsx(Se,{onSelect:()=>{o(m=>{m.lyricLines.splice(t+1,0,De())})},children:e("contextMenu.insertLineAfter","在后插入空行")}),s.jsx(Se,{onSelect:C,disabled:n===0,children:e("contextMenu.copyLine",{count:n,defaultValue:"复制行"})}),s.jsx(Se,{onSelect:L,disabled:!M,children:e("contextMenu.combineLine","合并行")}),s.jsx(Se,{onSelect:()=>{o(m=>{n===0?m.lyricLines.splice(t,1):m.lyricLines=m.lyricLines.filter(a=>!r.has(a.id))})},children:e("contextMenu.deleteLine",{count:n,defaultValue:"删除行"})})]});function L(){o(m=>{if(!M)return;const{minIdx:a,maxIdx:T}=M,p=m.lyricLines[a];for(let S=a+1;S<=T;S++){const _=m.lyricLines[S];p.words.push(..._.words)}p.endTime=m.lyricLines[T].endTime,m.lyricLines.splice(a+1,T-a)})}function C(){o(m=>{m.lyricLines=m.lyricLines.flatMap(a=>{if(!r.has(a.id))return a;const T={...a,id:De().id,words:a.words.map(p=>({...p,id:Ue().id}))};return[a,T]})})}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};function ke(t){t.words.length&&(t.startTime=t.words[0].startTime||t.startTime,t.endTime=t.words[t.words.length-1].endTime||t.endTime)}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const Zt=globalThis.jotaiAtomCache.get("C:\\Users\\Client\\Desktop\\amll-ttml-tool-main\\src\\components\\LyricLinesView\\lyric-word-menu.tsx/selectedLinesSizeAtom",ie(t=>t(Te).size));Zt.debugLabel="selectedLinesSizeAtom";Zt.debugLabel="selectedLinesSizeAtom";const Ht=globalThis.jotaiAtomCache.get("C:\\Users\\Client\\Desktop\\amll-ttml-tool-main\\src\\components\\LyricLinesView\\lyric-word-menu.tsx/selectedWordsSizeAtom",ie(t=>t(he).size));Ht.debugLabel="selectedWordsSizeAtom";Ht.debugLabel="selectedWordsSizeAtom";const $t=({wordIndex:t,wordAtom:e,lineIndex:n})=>{const{t:r}=Xe(),o=dt(),i=W(Ht),u=W(Zt),c=ae(Le),b=yt(fn),y=yt(mn),h=W(e);return s.jsxs(s.Fragment,{children:[s.jsx(Se,{disabled:i!==1,onSelect:()=>{y({wordIndex:t,lineIndex:n,word:h.word}),b(!0)},children:r("contextMenu.splitReplaceWord","拆分或替换单词…")}),s.jsx(Se,{disabled:!(i>1&&u===1),onSelect:()=>{c(g=>{const L=o.get(he),C=g.lyricLines[n];if(C){const m=C.words.filter(a=>L.has(a.id));if(m.length>1){const a=m.map(j=>j.word).join(""),T=m[0],p=m[m.length-1],S=C.words.indexOf(T),_=Ue();_.word=a,_.startTime=T.startTime,_.endTime=p.endTime,g.lyricLines[n].words=C.words.filter(j=>!L.has(j.id)),S!==-1&&g.lyricLines[n].words.splice(S,0,_)}}})},children:r("contextMenu.combineWords","合并单词")}),s.jsx(Se,{disabled:i===0,onSelect:()=>{c(g=>{const L=o.get(he);for(const C of g.lyricLines){const m=C.words.length,a=C.words.filter(T=>!L.has(T.id));C.words=a,m!==a.length&&ke(C)}})},children:r("contextMenu.deleteWords",{count:i,defaultValue:"删除选定单词"})}),s.jsx(bt,{}),s.jsx(Se,{disabled:i!==1,onSelect:()=>x(),children:r("contextMenu.moveFollowingWordToNewLine","此后单词拆至新行")}),s.jsx(Se,{disabled:i===0,onSelect:()=>M(),children:r("contextMenu.moveWordToNewLine",{count:i,defaultValue:"所选单词拆至新行"})}),s.jsx(bt,{})]});function M(){c(g=>{const L=o.get(he),C=[];for(const a of g.lyricLines){const T=a.words.length>0&&(L.has(a.words[0].id)||L.has(a.words[a.words.length-1].id));a.words=a.words.filter(p=>L.has(p.id)?(C.push(p),!1):!0),T&&ke(a)}const m={...De(),isBG:g.lyricLines[n].isBG,isDuet:g.lyricLines[n].isDuet};m.words.push(...C),ke(m),g.lyricLines.splice(n+1,0,m)})}function x(){c(g=>{const L=g.lyricLines[n];if(!L)return;const C=L.words[t];if(!C)return;/^\s*$/.test(C.word)&&!C.startTime&&!C.endTime&&L.words.splice(t,1);const m=L.words.splice(t),a={...De(),isBG:L.isBG,isDuet:L.isDuet};a.words.push(...m),ke(L),ke(a),g.lyricLines.splice(n+1,0,a)})}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const He=globalThis.jotaiAtomCache.get("C:\\Users\\Client\\Desktop\\amll-ttml-tool-main\\src\\components\\LyricLinesView\\lyric-word-view.tsx/isDraggingAtom",ie(!1));He.debugLabel="isDraggingAtom";He.debugLabel="isDraggingAtom";const vt=t=>{const e=Ce.c(2);let n;return e[0]!==t?(n=t.length===0||t.length>0&&t.trim().length===0,e[0]=t,e[1]=n):n=e[1],n},Hn=t=>{const e=Ce.c(56),{wordAtom:n,wordIndex:r,line:o,lineIndex:i,className:u,children:c,onDoubleClick:b}=t,y=W(n),h=dt(),M=ae(Le),x=ae(Te);let g;e[0]!==n?(g=ie(I=>I(he).has(I(n).id)),e[0]=n,e[1]=g):g=e[1];const C=W(g),m=W(he),a=ae(he),T=W(ze);let p;e[2]!==o||e[3]!==x||e[4]!==a||e[5]!==y||e[6]!==r?(p=function(z){z.ctrlKey||z.metaKey?a(F=>{F.has(y.id)?F.delete(y.id):F.add(y.id)}):z.shiftKey?a(F=>{if(F.size>0){let k=Number.NaN,ee=Number.NaN;o.words.forEach((l,D)=>{F.has(l.id)&&(Number.isNaN(k)&&(k=D),Number.isNaN(ee)&&(ee=D),k=Math.min(k,D,r),ee=Math.max(ee,D,r))});for(let l=k;l<=ee;l++)F.add(o.words[l].id)}else F.add(y.id)}):(x(F=>{(!F.has(o.id)||F.size!==1)&&(F.clear(),F.add(o.id))}),a(F=>{(!F.has(y.id)||F.size!==1)&&(F.clear(),F.add(y.id))}))},e[2]=o,e[3]=x,e[4]=a,e[5]=y,e[6]=r,e[7]=p):p=e[7];const S=p;let _;e[8]!==C||e[9]!==o||e[10]!==x||e[11]!==a||e[12]!==y?(_=I=>{I&&(C||(a(z=>{z.clear(),z.add(y.id)}),x(z=>{z.clear(),z.add(o.id)})))},e[8]=C,e[9]=o,e[10]=x,e[11]=a,e[12]=y,e[13]=_):_=e[13];const j=T===X.Edit;let A;e[14]!==C||e[15]!==S||e[16]!==h?(A=I=>{C||S(I),I.dataTransfer.effectAllowed="copyMove",I.dataTransfer.dropEffect="move",h.set(He,!0),I.stopPropagation()},e[14]=C,e[15]=S,e[16]=h,e[17]=A):A=e[17];let P;e[18]!==h?(P=()=>{h.set(He,!1)},e[18]=h,e[19]=P):P=e[19];let f;e[20]!==C||e[21]!==h?(f=I=>{if(!h.get(He)||C)return;I.preventDefault(),I.dataTransfer.dropEffect="move";const z=I.currentTarget.getBoundingClientRect();I.clientX-z.left<z.width/2?(I.currentTarget.classList.add(E.dropLeft),I.currentTarget.classList.remove(E.dropRight)):(I.currentTarget.classList.remove(E.dropLeft),I.currentTarget.classList.add(E.dropRight));const k=I.ctrlKey||I.metaKey;I.dataTransfer.dropEffect=k?"copy":"move"},e[20]=C,e[21]=h,e[22]=f):f=e[22];let w;e[23]!==M||e[24]!==C||e[25]!==o||e[26]!==m||e[27]!==a||e[28]!==h||e[29]!==y?(w=I=>{if(I.currentTarget.classList.remove(E.dropLeft),I.currentTarget.classList.remove(E.dropRight),!h.get(He)||C)return;const z=I.currentTarget.getBoundingClientRect(),k=I.clientX-z.left>z.width/2,ee=I.ctrlKey||I.metaKey;M(l=>{let D=[];for(const H of l.lyricLines){const fe=H.words.filter(Y=>m.has(Y.id));if(D.push(...fe),!ee){const Y=H.words.length>0&&(m.has(H.words[0].id)||m.has(H.words[H.words.length-1].id));H.words=H.words.filter(ve=>!m.has(ve.id)),Y&&ke(H)}}const O=l.lyricLines.find(H=>{const{id:fe}=H;return fe===o.id});if(!O)throw new Error("Target line not found");const te=O.words.findIndex(H=>H.id===y.id);if(te<0)throw new Error("Target word not found");ee&&(D=D.map(Is),a(H=>{H.clear(),D.forEach(fe=>H.add(fe.id))}));const ue=te+(k?1:0),Ee=ue===0||ue===O.words.length;O.words.splice(ue,0,...D),Ee&&ke(O)})},e[23]=M,e[24]=C,e[25]=o,e[26]=m,e[27]=a,e[28]=h,e[29]=y,e[30]=w):w=e[30];let v;e[31]!==S?(v=I=>{I.stopPropagation(),I.preventDefault(),S(I)},e[31]=S,e[32]=v):v=e[32];let N;e[33]!==c||e[34]!==u||e[35]!==b||e[36]!==j||e[37]!==A||e[38]!==P||e[39]!==f||e[40]!==w||e[41]!==v?(N=s.jsx(mt,{children:s.jsx("span",{draggable:j,onDragStart:A,onDragEnd:P,onDragOver:f,onDrop:w,onDragLeave:Ws,className:u,onDoubleClick:b,onClick:v,children:c})}),e[33]=c,e[34]=u,e[35]=b,e[36]=j,e[37]=A,e[38]=P,e[39]=f,e[40]=w,e[41]=v,e[42]=N):N=e[42];let B;e[43]!==i||e[44]!==n||e[45]!==r?(B=s.jsx($t,{wordAtom:n,wordIndex:r,lineIndex:i}),e[43]=i,e[44]=n,e[45]=r,e[46]=B):B=e[46];let V;e[47]!==i?(V=s.jsx(Ct,{lineIndex:i}),e[47]=i,e[48]=V):V=e[48];let U;e[49]!==B||e[50]!==V?(U=s.jsxs(ht,{children:[B,V]}),e[49]=B,e[50]=V,e[51]=U):U=e[51];let Z;return e[52]!==N||e[53]!==U||e[54]!==_?(Z=s.jsxs(ft,{onOpenChange:_,children:[N,U]}),e[52]=N,e[53]=U,e[54]=_,e[55]=Z):Z=e[55],Z};function xt(t){const e=Ce.c(35);let n,r,o,i,u,c;e[0]!==t?({wordAtom:c,fieldName:r,formatter:o,parser:u,children:n,...i}=t,e[0]=t,e[1]=n,e[2]=r,e[3]=o,e[4]=i,e[5]=u,e[6]=c):(n=e[1],r=e[2],o=e[3],i=e[4],u=e[5],c=e[6]);const[b,y]=d.useState(void 0),[h,M]=d.useState(""),x=ae(Le);let g;e[7]!==r||e[8]!==o||e[9]!==c?(g=ie(v=>{const N=v(c);return o(N[r])}),e[7]=r,e[8]=o,e[9]=c,e[10]=g):g=e[10];const C=W(g),m=dt();let a;e[11]!==C||e[12]!==x||e[13]!==r||e[14]!==u||e[15]!==m||e[16]!==c?(a=v=>{try{const N=m.get(c),B=u(v);x(V=>{for(const U of V.lyricLines)for(const Z of U.words)if(N.id===Z.id){Z[r]=B;break}return V})}catch{typeof C=="string"&&y(C)}},e[11]=C,e[12]=x,e[13]=r,e[14]=u,e[15]=m,e[16]=c,e[17]=a):a=e[17];const T=a;let p,S;e[18]!==C?(p=()=>{y(C),M("")},S=[C],e[18]=C,e[19]=p,e[20]=S):(p=e[19],S=e[20]),d.useLayoutEffect(p,S);const _=b??"",j=b===void 0;let A;e[21]===Symbol.for("react.memo_cache_sentinel")?(A=v=>y(v.currentTarget.value),e[21]=A):A=e[21];let P;e[22]!==T?(P=v=>{v.key==="Enter"&&T(v.currentTarget.value)},e[22]=T,e[23]=P):P=e[23];let f;e[24]!==C||e[25]!==T?(f=v=>{v.currentTarget.value!==C&&T(v.currentTarget.value)},e[24]=C,e[25]=T,e[26]=f):f=e[26];let w;return e[27]!==n||e[28]!==h||e[29]!==i||e[30]!==_||e[31]!==j||e[32]!==P||e[33]!==f?(w=s.jsx(ut,{size:"1",value:_,placeholder:h,disabled:j,onChange:A,onKeyDown:P,onBlur:f,...i,children:n}),e[27]=n,e[28]=h,e[29]=i,e[30]=_,e[31]=j,e[32]=P,e[33]=f,e[34]=w):w=e[34],w}const _s=t=>{const e=Ce.c(72),{wordAtom:n,wordIndex:r,line:o,lineIndex:i}=t,u=dt(),c=ae(Le),b=yt(fn),y=yt(mn),h=W(n),M=W(ze);let x;e[0]!==n?(x=ie(pe=>pe(he).has(pe(n).id)),e[0]=n,e[1]=x):x=e[1];const L=W(x),C=vt(h.word),m=h.startTime>h.endTime,a=L&&E.selected,T=C&&E.blank,p=m&&M===X.Edit&&E.error;let S;e[2]!==a||e[3]!==T||e[4]!==p?(S=Q(E.lyricWord,E.edit,E.advance,a,T,p),e[2]=a,e[3]=T,e[4]=p,e[5]=S):S=e[5];const _=S;let j;e[6]===Symbol.for("react.memo_cache_sentinel")?(j={minWidth:"0"},e[6]=j):j=e[6];let A;e[7]===Symbol.for("react.memo_cache_sentinel")?(A=s.jsx(_t,{children:s.jsx(po,{})}),e[7]=A):A=e[7];let P;e[8]!==n?(P=s.jsx(xt,{size:"1",color:"green",wordAtom:n,fieldName:"startTime",formatter:Ke,parser:en,style:j,children:A}),e[8]=n,e[9]=P):P=e[9];let f;e[10]!==h.word||e[11]!==i||e[12]!==b||e[13]!==y||e[14]!==r?(f=()=>{y({wordIndex:r,lineIndex:i,word:h.word}),b(!0)},e[10]=h.word,e[11]=i,e[12]=b,e[13]=y,e[14]=r,e[15]=f):f=e[15];let w;e[16]===Symbol.for("react.memo_cache_sentinel")?(w=s.jsx(yo,{}),e[16]=w):w=e[16];let v;e[17]!==f?(v=s.jsx(qe,{variant:"soft",size:"1",onClick:f,children:w}),e[17]=f,e[18]=v):v=e[18];let N;e[19]===Symbol.for("react.memo_cache_sentinel")?(N={minWidth:"0em"},e[19]=N):N=e[19];let B;e[20]!==n?(B=s.jsx(xt,{size:"1",wordAtom:n,fieldName:"word",formatter:String,parser:String,style:N}),e[20]=n,e[21]=B):B=e[21];let V;e[22]!==c||e[23]!==u?(V=()=>{c(pe=>{const Me=u.get(he);for(const Ae of pe.lyricLines)Ae.words=Ae.words.filter(Je=>!Me.has(Je.id))})},e[22]=c,e[23]=u,e[24]=V):V=e[24];let U;e[25]===Symbol.for("react.memo_cache_sentinel")?(U=s.jsx(Pr,{}),e[25]=U):U=e[25];let Z;e[26]!==V?(Z=s.jsx(qe,{variant:"soft",size:"1",onClick:V,children:U}),e[26]=V,e[27]=Z):Z=e[27];let I;e[28]!==v||e[29]!==B||e[30]!==Z?(I=s.jsxs("div",{className:E.advanceBar,children:[v,B,Z]}),e[28]=v,e[29]=B,e[30]=Z,e[31]=I):I=e[31];let z;e[32]===Symbol.for("react.memo_cache_sentinel")?(z={minWidth:"0"},e[32]=z):z=e[32];let F;e[33]===Symbol.for("react.memo_cache_sentinel")?(F=s.jsx(_t,{children:s.jsx(xo,{})}),e[33]=F):F=e[33];let k;e[34]!==n?(k=s.jsx(xt,{size:"1",color:"red",wordAtom:n,fieldName:"endTime",formatter:Ke,parser:en,style:z,children:F}),e[34]=n,e[35]=k):k=e[35];let ee;e[36]===Symbol.for("react.memo_cache_sentinel")?(ee={minWidth:"0"},e[36]=ee):ee=e[36];let l;e[37]===Symbol.for("react.memo_cache_sentinel")?(l=s.jsx(_t,{children:s.jsx(To,{})}),e[37]=l):l=e[37];let D;e[38]!==n?(D=s.jsx(xt,{size:"1",type:"number",min:0,wordAtom:n,fieldName:"emptyBeat",formatter:String,parser:Number.parseInt,style:ee,children:l}),e[38]=n,e[39]=D):D=e[39];let O;e[40]!==h.emptyBeat||e[41]!==h.word||e[42]!==c?(O=()=>{c(pe=>{for(const Me of pe.lyricLines)for(const Ae of Me.words)Ae.word===h.word&&(Ae.emptyBeat=h.emptyBeat)})},e[40]=h.emptyBeat,e[41]=h.word,e[42]=c,e[43]=O):O=e[43];let te;e[44]===Symbol.for("react.memo_cache_sentinel")?(te=s.jsx(wo,{}),e[44]=te):te=e[44];let ue;e[45]!==O?(ue=s.jsx(qe,{variant:"soft",size:"1",onClick:O,children:te}),e[45]=O,e[46]=ue):ue=e[46];let Ee;e[47]!==D||e[48]!==ue?(Ee=s.jsxs("div",{className:E.advanceBar,children:[D,ue]}),e[47]=D,e[48]=ue,e[49]=Ee):Ee=e[49];let H;e[50]!==_||e[51]!==o||e[52]!==i||e[53]!==I||e[54]!==k||e[55]!==Ee||e[56]!==P||e[57]!==n||e[58]!==r?(H=s.jsx(mt,{children:s.jsxs(Hn,{wordAtom:n,wordIndex:r,lineIndex:i,className:_,line:o,children:[P,I,k,Ee]})}),e[50]=_,e[51]=o,e[52]=i,e[53]=I,e[54]=k,e[55]=Ee,e[56]=P,e[57]=n,e[58]=r,e[59]=H):H=e[59];let fe;e[60]!==i||e[61]!==n||e[62]!==r?(fe=s.jsx($t,{wordAtom:n,wordIndex:r,lineIndex:i}),e[60]=i,e[61]=n,e[62]=r,e[63]=fe):fe=e[63];let Y;e[64]!==i?(Y=s.jsx(Ct,{lineIndex:i}),e[64]=i,e[65]=Y):Y=e[65];let ve;e[66]!==fe||e[67]!==Y?(ve=s.jsxs(ht,{children:[fe,Y]}),e[66]=fe,e[67]=Y,e[68]=ve):ve=e[68];let we;return e[69]!==H||e[70]!==ve?(we=s.jsxs(ft,{children:[H,ve]}),e[69]=H,e[70]=ve,e[71]=we):we=e[71],we},js=t=>{const e=Ce.c(25),{wordAtom:n,wordIndex:r,line:o,lineIndex:i}=t,u=W(n),c=ae(Le),b=ae(Te);let y;e[0]!==n?(y=ie(v=>v(he).has(v(n).id)),e[0]=n,e[1]=y):y=e[1];const M=W(y),x=ae(he),[g,L]=d.useState(!1),C=W(ze),m=vt(u.word),a=$n(u.word,m),T=u.startTime>u.endTime,p=M&&E.selected,S=m&&E.blank,_=T&&C===X.Edit&&E.error;let j;e[2]!==p||e[3]!==S||e[4]!==_?(j=Q(E.lyricWord,E.edit,p,S,_),e[2]=p,e[3]=S,e[4]=_,e[5]=j):j=e[5];const A=j;let P;e[6]!==c||e[7]!==i||e[8]!==u.word||e[9]!==r?(P=v=>{L(!1);const N=v.currentTarget.value;N!==u.word&&c(B=>{B.lyricLines[i].words[r].word=N})},e[6]=c,e[7]=i,e[8]=u.word,e[9]=r,e[10]=P):P=e[10];const f=P;let w;return e[11]!==A||e[12]!==a||e[13]!==g||e[14]!==M||e[15]!==o||e[16]!==i||e[17]!==f||e[18]!==b||e[19]!==x||e[20]!==u.id||e[21]!==u.word||e[22]!==n||e[23]!==r?(w=g?s.jsx(ut,{autoFocus:!0,defaultValue:u.word,onBlur:f,onKeyDown:v=>{v.key==="Enter"&&f(v)}}):s.jsxs(ft,{onOpenChange:v=>{v&&(M||(x(N=>{N.clear(),N.add(u.id)}),b(N=>{N.clear(),N.add(o.id)})))},children:[s.jsx(mt,{children:s.jsx(Hn,{wordAtom:n,wordIndex:r,lineIndex:i,className:A,line:o,onDoubleClick:()=>{L(!0)},children:a})}),s.jsxs(ht,{children:[s.jsx($t,{wordAtom:n,wordIndex:r,lineIndex:i}),s.jsx(Ct,{lineIndex:i})]})]}),e[11]=A,e[12]=a,e[13]=g,e[14]=M,e[15]=o,e[16]=i,e[17]=f,e[18]=b,e[19]=x,e[20]=u.id,e[21]=u.word,e[22]=n,e[23]=r,e[24]=w):w=e[24],w},Rs=t=>{const e=Ce.c(38),{wordAtom:n,line:r}=t,o=W(n);let i;e[0]!==n?(i=ie(D=>D(he).has(D(n).id)),e[0]=n,e[1]=i):i=e[1];const u=i;let c;e[2]!==n?(c=ie(D=>{const O=D(Sr),te=D(n);return O>=te.startTime&&O<te.endTime}),e[2]=n,e[3]=c):c=e[3];const y=W(c),h=W(u),M=ae(he),x=ae(Te),g=W(hn),L=W(gn),C=W(Er),m=W(Ar),a=W(_r),T=W(ze),p=vt(o.word),S=$n(o.word,p,o.romanWord,a),_=d.useRef(null),j=d.useRef(null);let A;e[4]!==g?(A=()=>{if(!g)return;const D=_.current?.animate([{backgroundColor:"var(--green-a8)"},{backgroundColor:"var(--green-a4)"}],{duration:500});return()=>{D?.cancel()}},e[4]=g,e[5]=A):A=e[5];let P;e[6]!==g||e[7]!==o.startTime?(P=[o.startTime,g],e[6]=g,e[7]=o.startTime,e[8]=P):P=e[8],d.useEffect(A,P);let f;e[9]!==g?(f=()=>{if(!g)return;const D=j.current?.animate([{backgroundColor:"var(--red-a8)"},{backgroundColor:"var(--red-a4)"}],{duration:500});return()=>{D?.cancel()}},e[9]=g,e[10]=f):f=e[10];let w;e[11]!==g||e[12]!==o.endTime?(w=[o.endTime,g],e[11]=g,e[12]=o.endTime,e[13]=w):w=e[13],d.useEffect(f,w);const v=o.startTime>o.endTime,N=h&&E.selected,B=p&&E.blank,V=y&&m&&E.active,U=v&&(T===X.Edit||T===X.Sync&&L&&C)&&E.error;let Z;e[14]!==U||e[15]!==N||e[16]!==B||e[17]!==V?(Z=Q(E.lyricWord,E.sync,N,B,V,U),e[14]=U,e[15]=N,e[16]=B,e[17]=V,e[18]=Z):Z=e[18];const I=Z;let z;e[19]!==r||e[20]!==x||e[21]!==M||e[22]!==o.id?(z=D=>{D.stopPropagation(),D.preventDefault(),x(O=>{O.clear(),O.add(r.id)}),M(O=>{O.clear(),O.add(o.id)})},e[19]=r,e[20]=x,e[21]=M,e[22]=o.id,e[23]=z):z=e[23];let F;e[24]!==L||e[25]!==o.startTime?(F=L&&s.jsx("div",{className:Q(E.startTime),ref:_,children:Ke(o.startTime)}),e[24]=L,e[25]=o.startTime,e[26]=F):F=e[26];let k;e[27]!==S?(k=s.jsx("div",{className:E.displayWord,children:S}),e[27]=S,e[28]=k):k=e[28];let ee;e[29]!==L||e[30]!==o.endTime?(ee=L&&s.jsx("div",{className:Q(E.endTime),ref:j,children:Ke(o.endTime)}),e[29]=L,e[30]=o.endTime,e[31]=ee):ee=e[31];let l;return e[32]!==I||e[33]!==z||e[34]!==F||e[35]!==k||e[36]!==ee?(l=s.jsxs("div",{className:I,onClick:z,children:[F,k,ee]}),e[32]=I,e[33]=z,e[34]=F,e[35]=k,e[36]=ee,e[37]=l):l=e[37],l},$n=(t,e,n,r)=>{const o=Ce.c(5),{t:i}=Xe();let u;e:{if(r&&n&&n.trim()!==""){u=n;break e}if(t===""){let c;o[0]!==i?(c=i("lyricWordView.empty","空白"),o[0]=i,o[1]=c):c=o[1],u=c;break e}if(e){let c;o[2]!==i||o[3]!==t.length?(c=i("lyricWordView.spaceCount","空格 x{count}",{count:t.length}),o[2]=i,o[3]=t.length,o[4]=c):c=o[4],u=c;break e}u=t}return u},Ns=d.memo(t=>{const e=Ce.c(25),{wordAtom:n,wordIndex:r,line:o,lineIndex:i}=t,u=W(n),c=W(ze),b=W(Mr),y=vt(u.word);let h;e[0]!==b||e[1]!==o||e[2]!==i||e[3]!==c||e[4]!==n||e[5]!==r?(h=c===X.Edit&&b===Qt.Simple&&s.jsx(js,{wordAtom:n,line:o,lineIndex:i,wordIndex:r}),e[0]=b,e[1]=o,e[2]=i,e[3]=c,e[4]=n,e[5]=r,e[6]=h):h=e[6];let M;e[7]!==b||e[8]!==o||e[9]!==i||e[10]!==c||e[11]!==n||e[12]!==r?(M=c===X.Edit&&b===Qt.Advance&&s.jsx(_s,{wordAtom:n,line:o,lineIndex:i,wordIndex:r}),e[7]=b,e[8]=o,e[9]=i,e[10]=c,e[11]=n,e[12]=r,e[13]=M):M=e[13];let x;e[14]!==y||e[15]!==o||e[16]!==i||e[17]!==c||e[18]!==n||e[19]!==r?(x=c===X.Sync&&!y&&s.jsx(Rs,{wordAtom:n,line:o,lineIndex:i,wordIndex:r}),e[14]=y,e[15]=o,e[16]=i,e[17]=c,e[18]=n,e[19]=r,e[20]=x):x=e[20];let g;return e[21]!==h||e[22]!==M||e[23]!==x?(g=s.jsxs("div",{children:[h,M,x]}),e[21]=h,e[22]=M,e[23]=x,e[24]=g):g=e[24],g});function Is(t){return{...t,id:Ue().id}}function Ws(t){t.currentTarget.classList.remove(E.dropLeft),t.currentTarget.classList.remove(E.dropRight)}const Ps="_romanWordView_d2j9o_1",Fs="_placeholder_d2j9o_11",It={romanWordView:Ps,placeholder:Fs};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const Bs=t=>{const e=Ce.c(32),{wordAtom:n,wordIndex:r,editingIndexAtom:o}=t,i=W(n),[u,c]=jr(o),b=ae(Le),[y,h]=d.useState(i.romanWord),M=d.useRef(null),x=u===r;let g;e[0]!==b||e[1]!==c||e[2]!==i.id||e[3]!==i.romanWord?(g=w=>{w!==i.romanWord&&b(v=>{for(const N of v.lyricLines){const B=N.words.find(V=>V.id===i.id);if(B){B.romanWord=w;break}}}),c(null)},e[0]=b,e[1]=c,e[2]=i.id,e[3]=i.romanWord,e[4]=g):g=e[4];const L=g;let C,m;e[5]!==x||e[6]!==i.romanWord?(C=()=>{x&&h(i.romanWord)},m=[x,i.romanWord],e[5]=x,e[6]=i.romanWord,e[7]=C,e[8]=m):(C=e[7],m=e[8]),d.useEffect(C,m);let a,T;e[9]!==x?(a=()=>{x&&(M.current?.focus(),M.current?.select())},T=[x],e[9]=x,e[10]=a,e[11]=T):(a=e[10],T=e[11]),d.useEffect(a,T);let p;e[12]!==L||e[13]!==c||e[14]!==r?(p=w=>{const v=w.currentTarget.value;e:switch(w.key){case"Enter":case"Tab":{w.preventDefault(),L(v),c(r+1);break e}case"Escape":{w.preventDefault(),c(null);break e}case"Backspace":{v===""&&(w.preventDefault(),L(""),c(r-1));break e}}},e[12]=L,e[13]=c,e[14]=r,e[15]=p):p=e[15];const S=p;if(x){let w;e[16]===Symbol.for("react.memo_cache_sentinel")?(w=B=>h(B.currentTarget.value),e[16]=w):w=e[16];let v;e[17]!==L?(v=B=>L(B.currentTarget.value),e[17]=L,e[18]=v):v=e[18];let N;return e[19]!==S||e[20]!==y||e[21]!==v?(N=s.jsx(ut,{ref:M,size:"1",className:It.romanWordView,value:y,onChange:w,onBlur:v,onKeyDown:S}),e[19]=S,e[20]=y,e[21]=v,e[22]=N):N=e[22],N}const _=!i.romanWord&&It.placeholder;let j;e[23]!==_?(j=Q(It.romanWordView,_),e[23]=_,e[24]=j):j=e[24];let A;e[25]!==c||e[26]!==r?(A=w=>{w.stopPropagation(),c(r)},e[25]=c,e[26]=r,e[27]=A):A=e[27];const P=i.romanWord||"...";let f;return e[28]!==P||e[29]!==j||e[30]!==A?(f=s.jsx(wt,{size:"1",variant:"soft",color:"gray",className:j,onClick:A,children:P}),e[28]=P,e[29]=j,e[30]=A,e[31]=f):f=e[31],f};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const $e=globalThis.jotaiAtomCache.get("C:\\Users\\Client\\Desktop\\amll-ttml-tool-main\\src\\components\\LyricLinesView\\lyric-line-view.tsx/isDraggingAtom",ie(!1));$e.debugLabel="isDraggingAtom";$e.debugLabel="isDraggingAtom";const ks=t=>{const e=Ce.c(6),{lineAtom:n,wordsContainer:r}=t;let o;e[0]!==n?(o=ie(y=>{const h=y(n),M=y(he);if(M.size===0)return Number.NaN;let x=Number.NaN,g=0;for(const L of h.words){if(M.has(L.id)){x=g;break}g++}return x}),e[0]=n,e[1]=o):o=e[1];const u=W(o);let c,b;return e[2]!==u||e[3]!==r?(c=()=>{if(Number.isNaN(u)||!r)return;const y=r.children[u];y&&r.scrollTo({left:y.offsetLeft-r.clientWidth/2,behavior:"auto"})},b=[u,r],e[2]=u,e[3]=r,e[4]=c,e[5]=b):(c=e[4],b=e[5]),d.useEffect(c,b),null},sn=d.memo(t=>{const e=Ce.c(19),{lineAtom:n,lineIndex:r,type:o}=t,i=ae(Le),u=W(n),[c,b]=d.useState(!1),{t:y}=Xe();let h;e[0]!==i||e[1]!==u||e[2]!==r||e[3]!==o?(h=a=>{b(!1);const T=a.currentTarget.value;T!==u[o]&&i(p=>{p.lyricLines[r][o]=T})},e[0]=i,e[1]=u,e[2]=r,e[3]=o,e[4]=h):h=e[4];const M=h;let x;e[5]!==y||e[6]!==o?(x=o==="translatedLyric"?y("lyricLineView.translatedLabel","翻译："):y("lyricLineView.romanLabel","音译："),e[5]=y,e[6]=o,e[7]=x):x=e[7];const g=x;let L;e[8]!==g?(L=s.jsx(at,{size:"2",children:g}),e[8]=g,e[9]=L):L=e[9];let C;e[10]!==c||e[11]!==u||e[12]!==M||e[13]!==y||e[14]!==o?(C=c?s.jsx(ut,{autoFocus:!0,size:"1",defaultValue:u[o],onBlur:M,onKeyDown:a=>{a.key==="Enter"&&M(a)}}):s.jsx(wt,{size:"2",color:"gray",variant:"ghost",onClick:a=>{a.stopPropagation(),b(!0)},children:u[o]||s.jsx(at,{color:"gray",children:y("lyricLineView.empty","无")})}),e[10]=c,e[11]=u,e[12]=M,e[13]=y,e[14]=o,e[15]=C):C=e[15];let m;return e[16]!==L||e[17]!==C?(m=s.jsxs(Be,{align:"baseline",children:[L,C]}),e[16]=L,e[17]=C,e[18]=m):m=e[18],m}),Ds=d.memo(({lineAtom:t,lineIndex:e})=>{const{t:n}=Xe(),r=W(t),o=ae(Te),i=d.useMemo(()=>{const f=ie(w=>w(Te).has(r.id));return f.debugLabel="a",f.debugLabel="a",f},[r.id]),u=d.useMemo(()=>pn(ie(f=>f(t).words)),[t]),c=W(u),b=W(i),y=ae(he),h=ae(Le),M=W(hn),x=W(gn),g=W(ze),L=dt(),C=d.useRef(null),m=d.useMemo(()=>{if(r.startTime>r.endTime)return!0;for(const f of r.words)if(f.startTime>f.endTime)return!0;return!1},[r.startTime,r.endTime,r.words]),a=W(Rr),T=W(Nr),p=W(Ir),S=d.useMemo(()=>ie(null),[]),_=d.useRef(null),j=d.useRef(null),[A,P]=d.useState(!1);return d.useEffect(()=>{if(!M)return;const f=_.current?.animate([{backgroundColor:"var(--green-a8)"},{backgroundColor:"var(--green-a4)"}],{duration:500});return()=>{f?.cancel()}},[r.startTime,M]),d.useLayoutEffect(()=>{g!==X.Edit&&P(!1)},[g]),d.useEffect(()=>{if(!M)return;const f=j.current?.animate([{backgroundColor:"var(--red-a8)"},{backgroundColor:"var(--red-a4)"}],{duration:500});return()=>{f?.cancel()}},[r.endTime,M]),s.jsxs(s.Fragment,{children:[s.jsx(ks,{lineAtom:t,wordsContainer:C.current}),A&&s.jsx(wt,{mx:"2",my:"1",variant:"soft",size:"1",style:{width:"calc(100% - var(--space-4))"},onClick:()=>{h(f=>{f.lyricLines.splice(e,0,De())}),P(!1)},children:n("lyricLineView.insertLine","在此插入新行")}),s.jsxs(ft,{onOpenChange:f=>{f&&(L.get(Te).has(r.id)||L.set(Te,new Set([r.id])))},children:[s.jsx(mt,{disabled:g!==X.Edit,children:s.jsx(Be,{mx:"2",my:"1",direction:"row",className:Q(E.lyricLine,b&&E.selected,g===X.Sync&&E.sync,g===X.Edit&&E.edit,r.ignoreSync&&E.ignoreSync,m&&g===X.Edit&&E.error),align:"center",gapX:"4",draggable:g===X.Edit,onDragStart:f=>{f.dataTransfer.dropEffect="move",L.set($e,!0),L.set(Ze,r.id)},onDragEnd:()=>{L.set($e,!1)},onDragOver:f=>{if(!L.get($e)||L.get(Ze)===r.id||b)return;f.preventDefault(),f.dataTransfer.dropEffect="move";const w=f.currentTarget.getBoundingClientRect();f.clientY-w.top<w.height/2?(f.currentTarget.classList.add(E.dropTop),f.currentTarget.classList.remove(E.dropBottom)):(f.currentTarget.classList.remove(E.dropTop),f.currentTarget.classList.add(E.dropBottom))},onDrop:f=>{if(f.currentTarget.classList.remove(E.dropTop),f.currentTarget.classList.remove(E.dropBottom),!L.get($e))return;const w=f.currentTarget.getBoundingClientRect(),v=f.clientY-w.top,N=L.get(Te),B=N.has(L.get(Ze))?N:new Set([L.get(Ze)]),V=v>=w.height/2?1:0;h(U=>{const Z=U.lyricLines.filter(F=>!B.has(F.id)),I=U.lyricLines.filter(F=>B.has(F.id)),z=Z.findIndex(F=>F.id===r.id);z<0||(U.lyricLines=[...Z.slice(0,z+V),...I,...Z.slice(z+V)])})},onDragLeave:f=>{f.currentTarget.classList.remove(E.dropTop),f.currentTarget.classList.remove(E.dropBottom)},onClick:f=>{f.stopPropagation(),f.preventDefault(),f.ctrlKey?o(w=>{w.has(r.id)?w.delete(r.id):w.add(r.id)}):f.shiftKey?o(w=>{if(w.size>0){let v=Number.NaN,N=Number.NaN;const B=L.get(Le).lyricLines;B.forEach((V,U)=>{w.has(V.id)&&(Number.isNaN(v)&&(v=U),Number.isNaN(N)&&(N=U),v=Math.min(v,U,e),N=Math.max(N,U,e))});for(let V=v;V<=N;V++)w.add(B[V].id)}else w.add(r.id)}):(o(w=>{(!w.has(r.id)||w.size!==1)&&(w.clear(),w.add(r.id))}),y(w=>{w.size!==0&&w.clear()}))},asChild:!0,children:s.jsxs("div",{children:[s.jsxs(Be,{direction:"column",align:"center",justify:"center",ml:"3",children:[s.jsx(at,{className:Q(E.lineNumber,r.ignoreSync&&E.ignored),align:"center",color:"gray",children:e+1}),r.isBG&&s.jsx(bo,{color:"#4466FF"}),r.isDuet&&s.jsx(Lo,{color:"#44AA33"})]}),s.jsxs("div",{className:Q(E.lyricLineContainer,g===X.Edit&&E.edit,g===X.Sync&&E.sync),children:[s.jsxs("div",{className:Q(E.lyricWordsContainer,g===X.Edit&&E.edit,g===X.Sync&&E.sync,!x&&E.hideTimestamps),ref:C,children:[c.map((f,w)=>{const v=L.get(f);return s.jsxs(d.Fragment,{children:[A&&s.jsx(qe,{size:"1",variant:"soft",onClick:N=>{N.preventDefault(),N.stopPropagation(),h(B=>{B.lyricLines[e].words.splice(w,0,Ue())})},children:s.jsx(jt,{})}),s.jsxs(Be,{direction:"column",align:"stretch",gap:"3",className:E.wordGroup,children:[s.jsx(Ns,{wordAtom:f,wordIndex:w,line:r,lineIndex:e}),g===X.Edit&&a&&s.jsx(Bs,{wordAtom:f,wordIndex:w,editingIndexAtom:S})]})]},`word-${v.id}`)}),A&&s.jsx(qe,{size:"1",variant:"soft",onClick:f=>{f.preventDefault(),f.stopPropagation(),h(w=>{w.lyricLines[e].words.push(Ue())})},children:s.jsx(jt,{})}),g===X.Edit&&s.jsx(ut,{placeholder:n("lyricLineView.insertWord","插入单词…"),className:Q(E.insertWordField,c.length===0&&E.empty),style:{alignSelf:"center"},onKeyDown:f=>{f.key==="Enter"&&(f.preventDefault(),f.stopPropagation(),h(w=>{w.lyricLines[e].words.push({...Ue(),word:f.currentTarget.value})}),f.currentTarget.value="")}})]}),g===X.Edit&&s.jsxs(s.Fragment,{children:[T&&s.jsx(sn,{lineAtom:t,lineIndex:e,type:"translatedLyric"}),p&&s.jsx(sn,{lineAtom:t,lineIndex:e,type:"romanLyric"})]})]}),g===X.Edit&&s.jsx(Be,{p:"3",children:s.jsx(qe,{size:"1",variant:A?"solid":"soft",onClick:f=>{f.preventDefault(),f.stopPropagation(),P(w=>!w)},children:s.jsx(jt,{})})}),g===X.Sync&&x&&s.jsxs(Be,{pr:"3",gap:"1",direction:"column",align:"stretch",children:[s.jsx("div",{className:E.startTime,ref:_,children:Ke(r.startTime)}),s.jsx("div",{className:E.endTime,ref:j,children:Ke(r.endTime)})]})]})})}),s.jsx(ht,{children:s.jsx(Ct,{lineIndex:e})})]}),A&&s.jsx(wt,{mx:"2",my:"1",variant:"soft",size:"1",style:{width:"calc(100% - var(--space-4))"},onClick:()=>{h(f=>{f.lyricLines.splice(e+1,0,De())}),P(!1)},children:n("lyricLineView.insertLine","在此插入新行")})]})});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const Ut=globalThis.jotaiAtomCache.get("C:\\Users\\Client\\Desktop\\amll-ttml-tool-main\\src\\components\\LyricLinesView\\index.tsx/lyricLinesOnlyAtom",pn(es(Le,t=>t.prop("lyricLines"))));Ut.debugLabel="lyricLinesOnlyAtom";Ut.debugLabel="lyricLinesOnlyAtom";const Gs=d.forwardRef((t,e)=>{const n=Ce.c(27),r=W(Ut),o=d.useRef(null),i=d.useRef(null),u=W(ze),{t:c}=Xe();let b;n[0]!==r||n[1]!==u?(b=ie(p=>{if(u!==X.Sync)return;const S=p(Te);let _=Number.NaN,j=0;for(const A of r){const P=p(A);if(S.has(P.id)){_=j;break}j++}if(!Number.isNaN(_))return _}),n[0]=r,n[1]=u,n[2]=b):b=n[2];const h=W(b);let M,x;n[3]!==h?(M=()=>{if(h===void 0)return;const p=i.current;if(!p)return;const S=p.parentElement;S&&o.current?.scrollToIndex({index:h,offset:S.clientHeight/-2+50})},x=[h],n[3]=h,n[4]=M,n[5]=x):(M=n[4],x=n[5]),d.useEffect(M,x);let g,L;if(n[6]===Symbol.for("react.memo_cache_sentinel")?(g=()=>i.current,L=[],n[6]=g,n[7]=L):(g=n[6],L=n[7]),d.useImperativeHandle(e,g,L),r.length===0){let p;n[8]!==c?(p=c("app.empty.title","没有歌词行"),n[8]=c,n[9]=p):p=n[9];let S;n[10]!==p?(S=s.jsx(at,{color:"gray",children:p}),n[10]=p,n[11]=S):S=n[11];let _;n[12]!==c?(_=c("app.empty.description","在顶部面板中添加新歌词行或从菜单栏打开 / 导入已有歌词"),n[12]=c,n[13]=_):_=n[13];let j;n[14]!==_?(j=s.jsx(at,{color:"gray",children:_}),n[14]=_,n[15]=j):j=n[15];let A;return n[16]!==e||n[17]!==S||n[18]!==j?(A=s.jsxs(Be,{flexGrow:"1",gap:"2",align:"center",justify:"center",direction:"column",height:"100%",ref:e,children:[S,j]}),n[16]=e,n[17]=S,n[18]=j,n[19]=A):A=n[19],A}const C=u===X.Sync?"20vh 0":void 0;let m;n[20]!==C?(m={padding:C,maxHeight:"100%",overflowY:"auto"},n[20]=C,n[21]=m):m=n[21];let a;n[22]!==r?(a=s.jsx(ns.ViewportList,{overscan:10,items:r,ref:o,viewportRef:i,children:Vs}),n[22]=r,n[23]=a):a=n[23];let T;return n[24]!==m||n[25]!==a?(T=s.jsx(Wr,{flexGrow:"1",style:m,ref:i,children:a}),n[24]=m,n[25]=a,n[26]=T):T=n[26],T});function Vs(t,e){return s.jsx(Ds,{lineAtom:t,lineIndex:e},`${t}`)}export{Gs as LyricLinesView,Gs as default};
//# sourceMappingURL=index-PepxhFlW.js.map
