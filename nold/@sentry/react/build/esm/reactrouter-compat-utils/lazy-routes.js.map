{"version":3,"file":"lazy-routes.js","sources":["../../../src/reactrouter-compat-utils/lazy-routes.tsx"],"sourcesContent":["import { addNonEnumerableProperty, debug, isThenable } from '@sentry/core';\nimport { DEBUG_BUILD } from '../debug-build';\nimport type { Location, RouteObject } from '../types';\n\n/**\n * Creates a proxy wrapper for an async handler function.\n */\nexport function createAsyncHandlerProxy(\n  originalFunction: (...args: unknown[]) => unknown,\n  route: RouteObject,\n  handlerKey: string,\n  processResolvedRoutes: (resolvedRoutes: RouteObject[], parentRoute?: RouteObject, currentLocation?: Location) => void,\n): (...args: unknown[]) => unknown {\n  const proxy = new Proxy(originalFunction, {\n    apply(target: (...args: unknown[]) => unknown, thisArg, argArray) {\n      const result = target.apply(thisArg, argArray);\n      handleAsyncHandlerResult(result, route, handlerKey, processResolvedRoutes);\n      return result;\n    },\n  });\n\n  addNonEnumerableProperty(proxy, '__sentry_proxied__', true);\n\n  return proxy;\n}\n\n/**\n * Handles the result of an async handler function call.\n */\nexport function handleAsyncHandlerResult(\n  result: unknown,\n  route: RouteObject,\n  handlerKey: string,\n  processResolvedRoutes: (resolvedRoutes: RouteObject[], parentRoute?: RouteObject, currentLocation?: Location) => void,\n): void {\n  if (isThenable(result)) {\n    (result as Promise<unknown>)\n      .then((resolvedRoutes: unknown) => {\n        if (Array.isArray(resolvedRoutes)) {\n          processResolvedRoutes(resolvedRoutes, route);\n        }\n      })\n      .catch((e: unknown) => {\n        DEBUG_BUILD && debug.warn(`Error resolving async handler '${handlerKey}' for route`, route, e);\n      });\n  } else if (Array.isArray(result)) {\n    processResolvedRoutes(result, route);\n  }\n}\n\n/**\n * Recursively checks a route for async handlers and sets up Proxies to add discovered child routes to allRoutes when called.\n */\nexport function checkRouteForAsyncHandler(\n  route: RouteObject,\n  processResolvedRoutes: (resolvedRoutes: RouteObject[], parentRoute?: RouteObject, currentLocation?: Location) => void,\n): void {\n  // Set up proxies for any functions in the route's handle\n  if (route.handle && typeof route.handle === 'object') {\n    for (const key of Object.keys(route.handle)) {\n      const maybeFn = route.handle[key];\n      if (typeof maybeFn === 'function' && !(maybeFn as { __sentry_proxied__?: boolean }).__sentry_proxied__) {\n        route.handle[key] = createAsyncHandlerProxy(maybeFn, route, key, processResolvedRoutes);\n      }\n    }\n  }\n\n  // Recursively check child routes\n  if (Array.isArray(route.children)) {\n    for (const child of route.children) {\n      checkRouteForAsyncHandler(child, processResolvedRoutes);\n    }\n  }\n}\n"],"names":[],"mappings":";;;AAIA;AACA;AACA;AACO,SAAS,uBAAuB;AACvC,EAAE,gBAAgB;AAClB,EAAE,KAAK;AACP,EAAE,UAAU;AACZ,EAAE,qBAAqB;AACvB,EAAmC;AACnC,EAAE,MAAM,KAAA,GAAQ,IAAI,KAAK,CAAC,gBAAgB,EAAE;AAC5C,IAAI,KAAK,CAAC,MAAM,EAAmC,OAAO,EAAE,QAAQ,EAAE;AACtE,MAAM,MAAM,MAAA,GAAS,MAAM,CAAC,KAAK,CAAC,OAAO,EAAE,QAAQ,CAAC;AACpD,MAAM,wBAAwB,CAAC,MAAM,EAAE,KAAK,EAAE,UAAU,EAAE,qBAAqB,CAAC;AAChF,MAAM,OAAO,MAAM;AACnB,IAAI,CAAC;AACL,GAAG,CAAC;;AAEJ,EAAE,wBAAwB,CAAC,KAAK,EAAE,oBAAoB,EAAE,IAAI,CAAC;;AAE7D,EAAE,OAAO,KAAK;AACd;;AAEA;AACA;AACA;AACO,SAAS,wBAAwB;AACxC,EAAE,MAAM;AACR,EAAE,KAAK;AACP,EAAE,UAAU;AACZ,EAAE,qBAAqB;AACvB,EAAQ;AACR,EAAE,IAAI,UAAU,CAAC,MAAM,CAAC,EAAE;AAC1B,IAAI,CAAC,MAAA;AACL,OAAO,IAAI,CAAC,CAAC,cAAc,KAAc;AACzC,QAAQ,IAAI,KAAK,CAAC,OAAO,CAAC,cAAc,CAAC,EAAE;AAC3C,UAAU,qBAAqB,CAAC,cAAc,EAAE,KAAK,CAAC;AACtD,QAAQ;AACR,MAAM,CAAC;AACP,OAAO,KAAK,CAAC,CAAC,CAAC,KAAc;AAC7B,QAAQ,eAAe,KAAK,CAAC,IAAI,CAAC,CAAC,+BAA+B,EAAE,UAAU,CAAC,WAAW,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC;AACtG,MAAM,CAAC,CAAC;AACR,EAAE,CAAA,MAAO,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE;AACpC,IAAI,qBAAqB,CAAC,MAAM,EAAE,KAAK,CAAC;AACxC,EAAE;AACF;;AAEA;AACA;AACA;AACO,SAAS,yBAAyB;AACzC,EAAE,KAAK;AACP,EAAE,qBAAqB;AACvB,EAAQ;AACR;AACA,EAAE,IAAI,KAAK,CAAC,MAAA,IAAU,OAAO,KAAK,CAAC,MAAA,KAAW,QAAQ,EAAE;AACxD,IAAI,KAAK,MAAM,GAAA,IAAO,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE;AACjD,MAAM,MAAM,UAAU,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC;AACvC,MAAM,IAAI,OAAO,OAAA,KAAY,UAAA,IAAc,CAAC,CAAC,OAAA,GAA6C,kBAAkB,EAAE;AAC9G,QAAQ,KAAK,CAAC,MAAM,CAAC,GAAG,IAAI,uBAAuB,CAAC,OAAO,EAAE,KAAK,EAAE,GAAG,EAAE,qBAAqB,CAAC;AAC/F,MAAM;AACN,IAAI;AACJ,EAAE;;AAEF;AACA,EAAE,IAAI,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,EAAE;AACrC,IAAI,KAAK,MAAM,KAAA,IAAS,KAAK,CAAC,QAAQ,EAAE;AACxC,MAAM,yBAAyB,CAAC,KAAK,EAAE,qBAAqB,CAAC;AAC7D,IAAI;AACJ,EAAE;AACF;;;;"}